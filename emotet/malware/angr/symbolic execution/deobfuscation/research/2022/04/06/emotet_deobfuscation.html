<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Emotet Deobfuscation | OALABS Research</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Emotet Deobfuscation" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Removing CFF Obfuscation From Emotet Using Angr and Symbolic Execution" />
<meta property="og:description" content="Removing CFF Obfuscation From Emotet Using Angr and Symbolic Execution" />
<link rel="canonical" href="https://research.openanalysis.net/emotet/malware/angr/symbolic%20execution/deobfuscation/research/2022/04/06/emotet_deobfuscation.html" />
<meta property="og:url" content="https://research.openanalysis.net/emotet/malware/angr/symbolic%20execution/deobfuscation/research/2022/04/06/emotet_deobfuscation.html" />
<meta property="og:site_name" content="OALABS Research" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-04-06T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Emotet Deobfuscation" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-04-06T00:00:00-05:00","datePublished":"2022-04-06T00:00:00-05:00","description":"Removing CFF Obfuscation From Emotet Using Angr and Symbolic Execution","headline":"Emotet Deobfuscation","mainEntityOfPage":{"@type":"WebPage","@id":"https://research.openanalysis.net/emotet/malware/angr/symbolic%20execution/deobfuscation/research/2022/04/06/emotet_deobfuscation.html"},"url":"https://research.openanalysis.net/emotet/malware/angr/symbolic%20execution/deobfuscation/research/2022/04/06/emotet_deobfuscation.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://research.openanalysis.net/feed.xml" title="OALABS Research" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">OALABS Research</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Emotet Deobfuscation</h1><p class="page-description">Removing CFF Obfuscation From Emotet Using Angr and Symbolic Execution</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-04-06T00:00:00-05:00" itemprop="datePublished">
        Apr 6, 2022
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      12 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#emotet">emotet</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#malware">malware</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#angr">angr</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#symbolic execution">symbolic execution</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#deobfuscation">deobfuscation</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#research">research</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-left">
            <div class="px-2">
                <a href="https://www.youtube.com/c/OALabs" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/badge/-YouTube-FF0000" alt="Join us on YouTube">
                </a>
            </div>
            <div class="px-2">
                <a href="https://www.twitch.tv/oalabslive" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/twitch/status/oalabslive?style=social" alt="Join us on Twitch">
                </a>
            </div>
            <div class="px-2">
                <a href="https://discord.gg/cw4U3WHvpn" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/badge/-Join Our Discord-blueviolet" alt="Join Discord">
                </a>
            </div>
            <div class="px-2">
                <a href="https://www.patreon.com/oalabs" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/badge/-OALABS Patreon-FF424D" alt="Support us on Patreon">
                </a>
            </div>
          <div class="px-2">

    <a href="https://github.com/OALabs/research/tree/master/_notebooks/2022-04-06-emotet_deobfuscation.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          
          
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Overview">Overview </a></li>
<li class="toc-entry toc-h2"><a href="#Approach-For-Identifying-Original-Basic-Blocks-(OBB)---Assembly/IDA-Only">Approach For Identifying Original Basic Blocks (OBB) - Assembly/IDA Only </a></li>
<li class="toc-entry toc-h2"><a href="#Deobfuscation-With-Symboic-Execution">Deobfuscation With Symboic Execution </a></li>
<li class="toc-entry toc-h2"><a href="#Approach-For-Identifying-Original-Basic-Blocks-(OBB)-Using-Symbolic-Execution">Approach For Identifying Original Basic Blocks (OBB) Using Symbolic Execution </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Glossary">Glossary </a></li>
<li class="toc-entry toc-h3"><a href="#The-Algorithm">The Algorithm </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-04-06-emotet_deobfuscation.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Overview">
<a class="anchor" href="#Overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview<a class="anchor-link" href="#Overview"> </a>
</h2>
<p>Sample: <code>c7574aac7583a5bdc446f813b8e347a768a9f4af858404371eae82ad2d136a01</code></p>
<p>Unpacked: <code>eeb13cd51faa7c23d9a40241d03beb239626fbf3efe1dbbfa3994fc10dea0827</code></p>
<p>References:</p>
<ul>
<li><a href="https://malshare.com/sample.php?action=detail&amp;hash=eeb13cd51faa7c23d9a40241d03beb239626fbf3efe1dbbfa3994fc10dea0827">Malshare Sample (Unpacked)</a></li>
</ul>
<p>Research:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=vf-cxgUXcMk">DFS and BFS graph traversal tutorial</a></li>
<li><a href="https://p.ost2.fyi/courses/course-v1:OpenSecurityTraining2+RE3201_symexec+2021_V1/course/">OST2 - Reverse Engineering 3201: Symbolic Analysis</a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Approach-For-Identifying-Original-Basic-Blocks-(OBB)---Assembly/IDA-Only">
<a class="anchor" href="#Approach-For-Identifying-Original-Basic-Blocks-(OBB)---Assembly/IDA-Only" aria-hidden="true"><span class="octicon octicon-link"></span></a>Approach For Identifying Original Basic Blocks (OBB) - Assembly/IDA Only<a class="anchor-link" href="#Approach-For-Identifying-Original-Basic-Blocks-(OBB)---Assembly/IDA-Only"> </a>
</h2>
<p>Shout out to <a href="https://github.com/sponsors/mrexodia">@mrexodia</a> full credit goes to him for this approach!</p>
<p><img src="https://i.imgur.com/KTCpxRx.png" alt=""></p>
<p>We are doing a breadth-first search through bb. This is specific to the binary we are analyzing, we just noticed that the <code>jz</code>/<code>jnz</code> is used for dispatcher control flow (it will differ for other binaries). For our search algorithm we will relie on this to mark a transition from the cf to an obb.</p>
<p>The generic algorithm.</p>
<ul>
<li>Assume two states (not the same as the cff states) <strong>in obb</strong> and <strong>in cf</strong>. </li>
<li>Walk the graph in a bredth first search (BFS) and track your current state.<ul>
<li>When you are <strong>in cf</strong> you can transition to <strong>in obb</strong> on the positive branch of a <code>jz</code> or the negative branch of a <code>jnz</code>. </li>
<li>If you are <strong>in obb</strong> you don't exit until you hit an already identified <strong>in obb</strong> bb. </li>
</ul>
</li>
<li>Mark each bb as you go</li>
</ul>
<p>This works because we are doing a BFS and the CFF forces a loop back to the dispatcher so we are garunteed to have already seen the dispatcher <strong>in cf</strong> bb before we reach the end of the first <strong>in obb</strong>.</p>
<p>The specific algorithm.</p>
<ul>
<li>start at the disptacher entry this is the first dispatcher block</li>
<li>for each next bb if it doesn't end in a jz/jnz then we mark as dispatcher and search forward</li>
<li>if we are in a dispatcher and end with a jz the TRUE points to a obb and the FALSE points to another dispatcher</li>
<li>if we are in a dispatcher and end with a jnz the FALSE points to a obb and the TRUE points to another dispatcher</li>
<li>mark the blocks and continue our search BFS</li>
<li>if we are in an obb mark every next bb as an obb until we see a dispatcher block (then end that trace)</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">idaapi</span>
<span class="kn">import</span> <span class="nn">idautils</span>
<span class="kn">import</span> <span class="nn">idc</span>
<span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Queue</span>
<span class="kn">import</span> <span class="nn">struct</span>

<span class="c1"># Basic blocks for dispatcher and obb</span>
<span class="c1"># bb_states[start_address] = obb = True/False (obb or dispatcher)</span>
<span class="n">bb_states</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">bb_visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>


<span class="n">fn_start</span> <span class="o">=</span> <span class="mh">0x10008784</span>
<span class="n">fn_end</span> <span class="o">=</span> <span class="mh">0x100099D2</span> 

<span class="n">dispatcher_start</span> <span class="o">=</span> <span class="mh">0x1000953A</span> 


<span class="n">function</span> <span class="o">=</span> <span class="n">idaapi</span><span class="o">.</span><span class="n">get_func</span><span class="p">(</span><span class="n">fn_start</span><span class="p">)</span>
<span class="n">flowchart</span> <span class="o">=</span> <span class="n">idaapi</span><span class="o">.</span><span class="n">FlowChart</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>


<span class="c1"># Get bb flowchart starting with dispatcher</span>
<span class="n">dispatcher_flowchart</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">flowchart</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">succs</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Use a queue for BFS </span>
<span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>

<span class="c1"># Push dispatcher start onto queue and add info</span>
<span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">dispatcher_flowchart</span><span class="p">)</span>
<span class="n">bb_states</span><span class="p">[</span><span class="n">dispatcher_flowchart</span><span class="o">.</span><span class="n">start_ea</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'obb'</span><span class="p">:</span><span class="kc">False</span> <span class="p">}</span>



<span class="c1"># Walk through bb</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">q</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
    <span class="n">bb_flowchart</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">bb_start</span> <span class="o">=</span> <span class="n">bb_flowchart</span><span class="o">.</span><span class="n">start_ea</span>
    <span class="c1"># Get bb_info</span>
    <span class="n">bb_info</span> <span class="o">=</span> <span class="n">bb_states</span><span class="p">[</span><span class="n">bb_start</span><span class="p">]</span>

    <span class="c1">#print(f"-&gt; {hex(bb_start)} {bb_info}")</span>

    <span class="k">if</span> <span class="n">bb_start</span> <span class="ow">in</span> <span class="n">bb_visited</span><span class="p">:</span>
        <span class="c1"># We don't need to re-process this just continue</span>
        <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bb_visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bb_start</span><span class="p">)</span>

    <span class="c1"># Check if there are successors</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">bb_flowchart</span><span class="o">.</span><span class="n">succs</span><span class="p">()))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="c1"># Check if the bb is conditional </span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">bb_flowchart</span><span class="o">.</span><span class="n">succs</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Parse the condition</span>
        <span class="n">bb_end</span> <span class="o">=</span> <span class="n">prev_head</span><span class="p">(</span><span class="n">bb_flowchart</span><span class="o">.</span><span class="n">end_ea</span><span class="p">)</span> 
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bb_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'obb'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">print_insn_mnem</span><span class="p">(</span><span class="n">bb_end</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'jz'</span><span class="p">:</span> 
            <span class="c1"># The true jmp indicated an obb</span>
            <span class="c1"># The false indicates more dispatcher</span>
            <span class="c1"># We are going to check which next bb matches the</span>
            <span class="c1"># true contidion for the jz</span>
            <span class="n">true_bb_address</span> <span class="o">=</span> <span class="n">get_operand_value</span><span class="p">(</span><span class="n">bb_end</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">next_bb_flowchart</span> <span class="ow">in</span> <span class="n">bb_flowchart</span><span class="o">.</span><span class="n">succs</span><span class="p">():</span>
                <span class="c1"># Get the next bb address</span>
                <span class="n">next_bb_start</span> <span class="o">=</span> <span class="n">next_bb_flowchart</span><span class="o">.</span><span class="n">start_ea</span>
                <span class="c1"># If we have already visited it ignore</span>
                <span class="k">if</span> <span class="n">next_bb_start</span> <span class="ow">in</span> <span class="n">bb_visited</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">next_bb_start</span> <span class="o">==</span> <span class="n">true_bb_address</span><span class="p">:</span>
                    <span class="c1"># Put next bb onto the queue</span>
                    <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">next_bb_flowchart</span><span class="p">)</span>
                    <span class="c1"># Mark the bb as an obb</span>
                    <span class="n">bb_states</span><span class="p">[</span><span class="n">next_bb_start</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'obb'</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># This is another dispatcher bb</span>
                    <span class="c1"># Put next bb onto the queue</span>
                    <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">next_bb_flowchart</span><span class="p">)</span>
                    <span class="c1"># Mark the bb as an obb</span>
                    <span class="n">bb_states</span><span class="p">[</span><span class="n">next_bb_start</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'obb'</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">bb_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'obb'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">print_insn_mnem</span><span class="p">(</span><span class="n">bb_end</span><span class="p">)</span> <span class="o">==</span> <span class="s1">'jnz'</span><span class="p">:</span> 
            <span class="c1"># The true jmp indicated an obb</span>
            <span class="c1"># The false indicates more dispatcher</span>
            <span class="c1"># We are going to check which next bb matches the</span>
            <span class="c1"># true contidion for the jz</span>
            <span class="n">true_bb_address</span> <span class="o">=</span> <span class="n">get_operand_value</span><span class="p">(</span><span class="n">bb_end</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">next_bb_flowchart</span> <span class="ow">in</span> <span class="n">bb_flowchart</span><span class="o">.</span><span class="n">succs</span><span class="p">():</span>
                <span class="c1"># Get the next bb address</span>
                <span class="n">next_bb_start</span> <span class="o">=</span> <span class="n">next_bb_flowchart</span><span class="o">.</span><span class="n">start_ea</span>
                <span class="c1"># If we have already visited it ignore</span>
                <span class="k">if</span> <span class="n">next_bb_start</span> <span class="ow">in</span> <span class="n">bb_visited</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">next_bb_start</span> <span class="o">==</span> <span class="n">true_bb_address</span><span class="p">:</span>
                    <span class="c1"># Put next bb onto the queue</span>
                    <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">next_bb_flowchart</span><span class="p">)</span>
                    <span class="c1"># Mark the bb as an obb</span>
                    <span class="n">bb_states</span><span class="p">[</span><span class="n">next_bb_start</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'obb'</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># This is another dispatcher bb</span>
                    <span class="c1"># Put next bb onto the queue</span>
                    <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">next_bb_flowchart</span><span class="p">)</span>
                    <span class="c1"># Mark the bb as an obb</span>
                    <span class="n">bb_states</span><span class="p">[</span><span class="n">next_bb_start</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'obb'</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># We can treat all next bb as if there is no condition</span>
            <span class="c1"># and propogate the bb type</span>
            <span class="k">for</span> <span class="n">next_bb_flowchart</span> <span class="ow">in</span> <span class="n">bb_flowchart</span><span class="o">.</span><span class="n">succs</span><span class="p">():</span>
                <span class="c1"># Get the next bb address</span>
                <span class="n">next_bb_start</span> <span class="o">=</span> <span class="n">next_bb_flowchart</span><span class="o">.</span><span class="n">start_ea</span>
                <span class="c1"># If we have already visited it ignore</span>
                <span class="k">if</span> <span class="n">next_bb_start</span> <span class="ow">in</span> <span class="n">bb_visited</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="c1"># Add it to the queue and add info same as current block</span>
                <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">next_bb_flowchart</span><span class="p">)</span>
                <span class="c1"># Set bb type based on this bb</span>
                <span class="n">bb_states</span><span class="p">[</span><span class="n">next_bb_flowchart</span><span class="o">.</span><span class="n">start_ea</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'obb'</span><span class="p">:</span><span class="n">bb_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'obb'</span><span class="p">)}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># No condition </span>
        <span class="n">next_bb_flowchart</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">bb_flowchart</span><span class="o">.</span><span class="n">succs</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># If not visited</span>
        <span class="k">if</span> <span class="n">next_bb_flowchart</span><span class="o">.</span><span class="n">start_ea</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bb_visited</span><span class="p">:</span>
            <span class="c1"># Push next block on queue and add info</span>
            <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">next_bb_flowchart</span><span class="p">)</span>
            <span class="c1"># Set bb type based on this bb</span>
            <span class="n">bb_states</span><span class="p">[</span><span class="n">next_bb_flowchart</span><span class="o">.</span><span class="n">start_ea</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'obb'</span><span class="p">:</span><span class="n">bb_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'obb'</span><span class="p">)}</span>


<span class="c1">#### ALL this for debugging </span>

<span class="c1"># Add color to bb just for debugging</span>


<span class="k">def</span> <span class="nf">set_bb_color</span><span class="p">(</span><span class="n">ea</span><span class="p">,</span> <span class="n">flowchart</span><span class="p">,</span> <span class="n">color_value</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">flowchart</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">start_ea</span> <span class="o">&lt;=</span> <span class="n">ea</span> <span class="ow">and</span> <span class="n">block</span><span class="o">.</span><span class="n">end_ea</span> <span class="o">&gt;</span> <span class="n">ea</span><span class="p">:</span>
            <span class="c1"># Loop and add color</span>
            <span class="n">ptr</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">start_ea</span>
            <span class="k">while</span> <span class="n">ptr</span> <span class="o">&lt;=</span> <span class="n">prev_head</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">end_ea</span><span class="p">):</span>
                <span class="n">set_color</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">CIC_ITEM</span><span class="p">,</span> <span class="n">color_value</span><span class="p">)</span>
                <span class="n">ptr</span> <span class="o">=</span> <span class="n">next_head</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
            <span class="k">break</span>

<span class="c1"># Verification conditions:</span>
<span class="c1">#  - all bb should be in the visited set</span>
<span class="c1">#  - each bb should have a type associated with it in the bb_states </span>

<span class="k">for</span> <span class="n">bb_addr</span> <span class="ow">in</span> <span class="n">bb_states</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">bb_addr</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">bb_states</span><span class="p">[</span><span class="n">bb_addr</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bb_states</span><span class="p">[</span><span class="n">bb_addr</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'obb'</span><span class="p">):</span>
        <span class="c1"># Make green for obb</span>
        <span class="n">set_bb_color</span><span class="p">(</span><span class="n">bb_addr</span><span class="p">,</span> <span class="n">flowchart</span><span class="p">,</span> <span class="mh">0x00ff00</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Make orange for dispatcher</span>
        <span class="n">set_bb_color</span><span class="p">(</span><span class="n">bb_addr</span><span class="p">,</span> <span class="n">flowchart</span><span class="p">,</span> <span class="mh">0x00A5ff</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Deobfuscation-With-Symboic-Execution">
<a class="anchor" href="#Deobfuscation-With-Symboic-Execution" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deobfuscation With Symboic Execution<a class="anchor-link" href="#Deobfuscation-With-Symboic-Execution"> </a>
</h2>
<p>Once we have identified the cf and obb blocks we can start using the familliar symbolic execution approach we used for Pandora Ransomware CFF.</p>
<p>TODO....</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Approach-For-Identifying-Original-Basic-Blocks-(OBB)-Using-Symbolic-Execution">
<a class="anchor" href="#Approach-For-Identifying-Original-Basic-Blocks-(OBB)-Using-Symbolic-Execution" aria-hidden="true"><span class="octicon octicon-link"></span></a>Approach For Identifying Original Basic Blocks (OBB) Using Symbolic Execution<a class="anchor-link" href="#Approach-For-Identifying-Original-Basic-Blocks-(OBB)-Using-Symbolic-Execution"> </a>
</h2>
<p>The drawback of the assembly approach is that the analyst must first identify what condition causes a transition between the obb and cf blocks. This is a manual process. If we want to fully automate this in a generic way we need to use symbolic execution to identify which bb are cf and which are obb.</p>
<p>For this approach the analyst must still identify how the <strong>state</strong> is tracked (register) but heuristics can also be used to do this automatically. Once we identify the state we can use the same algorithm above but instead of using a <code>jz</code>/<code>jnz</code> assembly compare to test for a transition between a cf and obb block we can check our symbolic exeuction predicate to see if the state is an equation or a constant (ie. does the state change in the bb or is it constant) if it is constant than we know the state was not modified so this is a cf block if the state can change then this is obb. We must also track if the state has changed and how it was changed to determine if the bb has transitioned from a cf to an obb.</p>
<h3 id="Glossary">
<a class="anchor" href="#Glossary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Glossary<a class="anchor-link" href="#Glossary"> </a>
</h3>
<ul>
<li>cf - control flow</li>
<li>bb - basic block</li>
<li>obb - original basic block (these are from before the obfuscation)</li>
<li>cf bb - control flow basic block also known as part of the dispatcher or "obfuscation code"</li>
<li>symbolic execution - a process of transforming bb assembly code into mathematical/logical equations that can be solved  </li>
<li>concolic execution - a mix of symbolic and real (emulation) excution ie. we sub in some concrete values to constrain the exectuion path where they exist in the code</li>
<li>BFS - breadth first search</li>
</ul>
<h3 id="The-Algorithm">
<a class="anchor" href="#The-Algorithm" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Algorithm<a class="anchor-link" href="#The-Algorithm"> </a>
</h3>
<p><strong>assumption</strong> we don't want to use concolic execution, we just want symbolic execution because we want to trace every branch and we don't want a concrete STATE value we want a symbol (I think???)</p>
<ul>
<li>on the entry to each bb reset to the STATE to be a symbol (I think this will force symboic execution)</li>
<li>for each bb step we check the following<ul>
<li>is the predicate an equation or a constant (ie. does it depend on the STATE). If it depends on the STATE then it must be a CF bb. </li>
<li>if it's a constant or the predicate an equation does NOT depend on the STATE then it must be the same type of bb as the previous one</li>
<li>check the STATE symbol, if it has been assigned a constant or an equation then this is a obb (if it's not undefined)</li>
<li>maintain a rolling label (<strong>cf</strong>/<strong>obb</strong>) for the bb as you step, propogate the label to each sequential bb until one of the above conditions is met</li>
<li>for each branch (new angr state) push this onto a queue and use a bfs approach </li>
<li>stop execution when we reach a labeled bb</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># BUGS!!</span>
<span class="c1">#</span>
<span class="c1"># This is a work in progress, we have atleast two bugs that cascate to create a bad graph</span>
<span class="c1"># 1) we need to fix the logic so we correctly identify the first cf bb</span>
<span class="c1"># 2) we need to figure out why angr chooses such weird bb breaks, like why break at random spots???</span>
<span class="c1">#</span>
<span class="c1">##############################################################################################</span>




<span class="kn">import</span> <span class="nn">angr</span><span class="o">,</span> <span class="nn">claripy</span>
<span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">Queue</span>
<span class="kn">import</span> <span class="nn">struct</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">'angr'</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s1">'ERROR'</span><span class="p">)</span>


<span class="n">BINARY_PATH</span> <span class="o">=</span> <span class="s1">'/tmp/emotet.bin'</span>

<span class="c1"># Save some info about each bb</span>
<span class="c1"># bb_states[bb_address] = {"is_obb":true/false} </span>
<span class="n">bb_states</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">bb_visited</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>


<span class="n">fn_start</span> <span class="o">=</span> <span class="mh">0x10008784</span>
<span class="n">fn_end</span> <span class="o">=</span> <span class="mh">0x100099D2</span> 

<span class="n">dispatcher_start</span> <span class="o">=</span> <span class="mh">0x1000953A</span> 



<span class="n">project</span> <span class="o">=</span> <span class="n">angr</span><span class="o">.</span><span class="n">Project</span><span class="p">(</span><span class="n">BINARY_PATH</span><span class="p">,</span> <span class="n">load_options</span><span class="o">=</span><span class="p">{</span><span class="s1">'auto_load_libs'</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>

<span class="c1"># TODO: We should explicately add the state since we know it (main)</span>
<span class="n">initial_state</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">call_state</span><span class="p">(</span><span class="n">addr</span><span class="o">=</span><span class="n">fn_start</span><span class="p">)</span>


<span class="c1"># Use this setting to skip calls instead of a hook</span>
<span class="n">initial_state</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">angr</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">CALLLESS</span><span class="p">)</span>


<span class="c1"># Setup simulation manager </span>
<span class="n">simgr</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">simgr</span><span class="p">(</span><span class="n">initial_state</span><span class="p">)</span>




<span class="c1"># We are going to start with an assumption that the first BB is in an obb </span>
<span class="c1"># Since we are using a queue we need to track this rolling state along with the address of the bb</span>
<span class="c1"># bb_info = {address:&lt;&gt;, prev_is_obb:true/false}</span>


<span class="c1"># Use a queue for BFS </span>
<span class="n">q</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>


<span class="c1"># Push function start onto queue</span>
<span class="n">bb_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'address'</span><span class="p">:</span><span class="n">fn_start</span><span class="p">,</span> <span class="s1">'prev_is_obb'</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>
<span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">bb_info</span><span class="p">)</span>



<span class="c1">## TODO: currently we don't handle when the first bb in a transition from a cf to obb doesn't set the STATE, </span>
<span class="c1">#        our algorithm will think this is just another cf bb</span>


<span class="c1"># Walk the queue</span>
<span class="k">while</span> <span class="ow">not</span> <span class="n">q</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
    <span class="n">bb_info</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    
    <span class="n">bb_address</span> <span class="o">=</span> <span class="n">bb_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'address'</span><span class="p">)</span>
    <span class="n">prev_bb_is_obb</span> <span class="o">=</span> <span class="n">bb_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'prev_is_obb'</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"BB: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">bb_address</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="c1">#print(project.factory.block(simgr.active[0].addr).pp())</span>
    
    <span class="c1"># Set the sim manager for the next state to remove any concrete value</span>
    <span class="n">new_state</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">blank_state</span><span class="p">(</span><span class="n">addr</span><span class="o">=</span><span class="n">bb_address</span><span class="p">)</span>
    <span class="n">new_state</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">angr</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">CALLLESS</span><span class="p">)</span>

    <span class="c1"># Use successors to determine info about this block</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">new_state</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># If there are no successors this is an end bb so it must be an obb</span>
        <span class="n">bb_states</span><span class="p">[</span><span class="n">bb_address</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'is_obb'</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>
        
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">new_state</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
        <span class="c1"># If there is only next bb then there is no condition</span>
        <span class="k">if</span> <span class="n">prev_bb_is_obb</span><span class="p">:</span>
            <span class="c1"># If we are in an obb keep the obb label </span>
            <span class="n">bb_states</span><span class="p">[</span><span class="n">bb_address</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'is_obb'</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If we are in an cf we need to test to see if we changed the STATE</span>
            <span class="c1"># this will move us into an obb</span>
            <span class="n">next_bb</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">new_state</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">next_bb</span><span class="o">.</span><span class="n">regs</span><span class="o">.</span><span class="n">ebx</span><span class="o">.</span><span class="n">uninitialized</span><span class="p">:</span>
                <span class="n">bb_states</span><span class="p">[</span><span class="n">bb_address</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'is_obb'</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
                <span class="n">prev_bb_is_obb</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bb_states</span><span class="p">[</span><span class="n">bb_address</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'is_obb'</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If there are multiple next bb then there is a condition </span>
        <span class="c1"># Determin if the branch depends on state</span>
        <span class="n">flag_depends_on_state</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">next_bb</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">new_state</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">next_bb</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">constraints</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">constraint</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">'reg_ebx'</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                        <span class="n">flag_depends_on_state</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># If the branch depends on state then this is a cf block</span>
        <span class="k">if</span> <span class="n">flag_depends_on_state</span><span class="p">:</span>
            <span class="n">bb_states</span><span class="p">[</span><span class="n">bb_address</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'is_obb'</span><span class="p">:</span><span class="kc">False</span><span class="p">}</span>
            <span class="n">prev_bb_is_obb</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bb_states</span><span class="p">[</span><span class="n">bb_address</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'is_obb'</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>
    
    <span class="c1"># Mark this bb as visited </span>
    <span class="n">bb_visited</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">bb_address</span><span class="p">)</span>
    <span class="c1"># Use successors to push next bb on queue </span>
    <span class="k">for</span> <span class="n">next_bb</span> <span class="ow">in</span> <span class="n">project</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">successors</span><span class="p">(</span><span class="n">new_state</span><span class="p">):</span>
        <span class="n">next_address</span> <span class="o">=</span> <span class="n">next_bb</span><span class="o">.</span><span class="n">addr</span>
        <span class="k">if</span> <span class="n">next_address</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bb_visited</span><span class="p">:</span>
            <span class="n">bb_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'address'</span><span class="p">:</span><span class="n">next_address</span><span class="p">,</span> <span class="s1">'prev_is_obb'</span><span class="p">:</span><span class="n">prev_bb_is_obb</span><span class="p">}</span>
            <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">bb_info</span><span class="p">)</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s2">"========================"</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">"DONE!"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>BB: 0x10008784
========================
BB: 0x10008914
========================
BB: 0x10008aa1
========================
BB: 0x10008c31
========================
BB: 0x10008dbb
========================
BB: 0x10008f47
========================
BB: 0x100090d0
========================
BB: 0x1000925d
========================
BB: 0x100093e6
========================
BB: 0x10009555
========================
BB: 0x10009894
========================
BB: 0x10009863
========================
BB: 0x1000955b
========================
BB: 0x100099c1
========================
BB: 0x100098a0
========================
BB: 0x1000988a
========================
BB: 0x100097cd
========================
BB: 0x10009563
========================
BB: 0x10009549
========================
BB: 0x100098e8
========================
BB: 0x100098a4
========================
BB: 0x1000953a
========================
BB: 0x100097e6
========================
BB: 0x10009713
========================
BB: 0x1000956f
========================
BB: 0x10009904
========================
BB: 0x100098ac
========================
BB: 0x100099c6
========================
BB: 0x10009830
========================
BB: 0x10009732
========================
BB: 0x100095a9
========================
BB: 0x10009573
========================
BB: 0x1000998c
========================
BB: 0x100098d8
========================
BB: 0x100099d2
========================
BB: 0x1000985b
========================
BB: 0x10009750
========================
BB: 0x100095c2
========================
BB: 0x1000957b
========================
BB: 0x10009998
========================
BB: 0x1000999f
========================
BB: 0x100098db
========================
BB: 0x100096fa
========================
BB: 0x1000977e
========================
BB: 0x100095e3
========================
BB: 0x10009595
========================
BB: 0x100099a4
========================
BB: 0x100099ba
========================
BB: 0x100097af
========================
BB: 0x10009615
========================
BB: 0x100099ba
========================
BB: 0x100097c5
========================
BB: 0x100096a2
========================
BB: 0x100096f5
========================
BB: 0x100096d6
========================
BB: 0x100096f2
========================
DONE!
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bb_states</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{268470148: {'is_obb': True},
 268470548: {'is_obb': True},
 268470945: {'is_obb': True},
 268471345: {'is_obb': True},
 268471739: {'is_obb': True},
 268472135: {'is_obb': True},
 268472528: {'is_obb': True},
 268472925: {'is_obb': True},
 268473318: {'is_obb': False},
 268473685: {'is_obb': True},
 268474516: {'is_obb': False},
 268474467: {'is_obb': False},
 268473691: {'is_obb': False},
 268474817: {'is_obb': True},
 268474528: {'is_obb': False},
 268474506: {'is_obb': False},
 268474317: {'is_obb': False},
 268473699: {'is_obb': False},
 268473673: {'is_obb': False},
 268474600: {'is_obb': False},
 268474532: {'is_obb': False},
 268473658: {'is_obb': False},
 268474342: {'is_obb': False},
 268474131: {'is_obb': False},
 268473711: {'is_obb': False},
 268474628: {'is_obb': False},
 268474540: {'is_obb': False},
 268474822: {'is_obb': False},
 268474416: {'is_obb': True},
 268474162: {'is_obb': False},
 268473769: {'is_obb': False},
 268473715: {'is_obb': False},
 268474764: {'is_obb': True},
 268474584: {'is_obb': True},
 268474834: {'is_obb': False},
 268474459: {'is_obb': False},
 268474192: {'is_obb': False},
 268473794: {'is_obb': False},
 268473723: {'is_obb': False},
 268474776: {'is_obb': False},
 268474783: {'is_obb': True},
 268474587: {'is_obb': True},
 268474106: {'is_obb': False},
 268474238: {'is_obb': True},
 268473827: {'is_obb': False},
 268473749: {'is_obb': True},
 268474788: {'is_obb': False},
 268474810: {'is_obb': False},
 268474287: {'is_obb': False},
 268473877: {'is_obb': False},
 268474309: {'is_obb': False},
 268474018: {'is_obb': True},
 268474101: {'is_obb': False},
 268474070: {'is_obb': False},
 268474098: {'is_obb': False}}</pre>
</div>

</div>

</div>
</div>

</div>
    

</div>



  </div><a class="u-url" href="/emotet/malware/angr/symbolic%20execution/deobfuscation/research/2022/04/06/emotet_deobfuscation.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://research.openanalysis.net/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>

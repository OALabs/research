<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>RisePro Triage | OALABS Research</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="RisePro Triage" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Config Extractor for PrivateLoader" />
<meta property="og:description" content="Config Extractor for PrivateLoader" />
<link rel="canonical" href="https://research.openanalysis.net/risepro/stealer/config/triage/2023/06/15/risepro.html" />
<meta property="og:url" content="https://research.openanalysis.net/risepro/stealer/config/triage/2023/06/15/risepro.html" />
<meta property="og:site_name" content="OALABS Research" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-06-15T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="RisePro Triage" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-06-15T00:00:00-05:00","datePublished":"2023-06-15T00:00:00-05:00","description":"Config Extractor for PrivateLoader","headline":"RisePro Triage","mainEntityOfPage":{"@type":"WebPage","@id":"https://research.openanalysis.net/risepro/stealer/config/triage/2023/06/15/risepro.html"},"url":"https://research.openanalysis.net/risepro/stealer/config/triage/2023/06/15/risepro.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://research.openanalysis.net/feed.xml" title="OALABS Research" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">OALABS Research</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">RisePro Triage</h1><p class="page-description">Config Extractor for PrivateLoader</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2023-06-15T00:00:00-05:00" itemprop="datePublished">
        Jun 15, 2023
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      14 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#risepro">risepro</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#stealer">stealer</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#config">config</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#triage">triage</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-left">
            <div class="px-2">
                <a href="https://www.youtube.com/c/OALabs" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/badge/-YouTube-FF0000" alt="Join us on YouTube">
                </a>
            </div>
            <div class="px-2">
                <a href="https://www.twitch.tv/oalabslive" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/twitch/status/oalabslive?style=social" alt="Join us on Twitch">
                </a>
            </div>
            <div class="px-2">
                <a href="https://discord.gg/cw4U3WHvpn" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/badge/-Join Our Discord-blueviolet" alt="Join Discord">
                </a>
            </div>
            <div class="px-2">
                <a href="https://www.patreon.com/oalabs" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/badge/-OALABS Patreon-FF424D" alt="Support us on Patreon">
                </a>
            </div>
          <div class="px-2">

    <a href="https://github.com/OALabs/research/tree/master/_notebooks/2023-06-15-risepro.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          
          
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Overview">Overview </a></li>
<li class="toc-entry toc-h2"><a href="#References">References </a></li>
<li class="toc-entry toc-h2"><a href="#Sample">Sample </a></li>
<li class="toc-entry toc-h2"><a href="#Analysis">Analysis </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Yara-Rule">Yara Rule </a></li>
<li class="toc-entry toc-h3"><a href="#C2">C2 </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#String-Decryption">String Decryption </a>
<ul>
<li class="toc-entry toc-h3"><a href="#X-Junior-IDA-Script">X-Junior IDA Script </a></li>
<li class="toc-entry toc-h3"><a href="#Andre-Tavares-Python-Script">Andre Tavares Python Script </a></li>
<li class="toc-entry toc-h3"><a href="#XorStr-Library">XorStr Library </a></li>
<li class="toc-entry toc-h3"><a href="#String-Extraction">String Extraction </a></li>
<li class="toc-entry toc-h3"><a href="#Samples">Samples </a></li>
<li class="toc-entry toc-h3"><a href="#Decryption-Algorithm">Decryption Algorithm </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2023-06-15-risepro.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Overview">
<a class="anchor" href="#Overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview<a class="anchor-link" href="#Overview"> </a>
</h2>
<p>According to <a href="https://flashpoint.io/blog/risepro-stealer-and-pay-per-install-malware-privateloader/https://flashpoint.io/blog/risepro-stealer-and-pay-per-install-malware-privateloader/">FlashPoint</a></p>
<blockquote>
<p>“RisePro” is a newly identified stealer written in C++ that appears to possess similar functionality to the stealer malware “Vidar.” RisePro targets potentially sensitive information on infected machines and attempts to exfiltrate it in the form of logs. “RisePro” is a newly identified stealer written in C++ that appears to possess similar functionality to the stealer malware “Vidar.” RisePro targets potentially sensitive information on infected machines and attempts to exfiltrate it in the form of logs.</p>
</blockquote>
<p>RisePRO triggered a false positive for the <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.privateloader">Malpedia PrivateLoader yara rule</a> and triggered the UnpacMe PrivateLoader config extractor. This led to correct string extraction from RisePRO even thought it is a separate malware. Are these related?!</p>
<h2 id="References">
<a class="anchor" href="#References" aria-hidden="true"><span class="octicon octicon-link"></span></a>References<a class="anchor-link" href="#References"> </a>
</h2>
<ul>
<li><a href="https://flashpoint.io/blog/risepro-stealer-and-pay-per-install-malware-privateloader/">“RisePro” Stealer and Pay-Per-Install Malware “PrivateLoader”</a></li>
<li><a href="https://research.openanalysis.net/privateloader/loader/config/triage/2022/09/08/privateloader.html">PrivateLoader Triage -  Config Extractor for PrivateLoader</a></li>
<li><a href="https://gist.github.com/andretavare5/66ec413cdb4c7c39d35c22d38c7067a8#file-privateloader_str_decrypt-py">privateloader_str_decrypt.py</a></li>
<li><a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.privateloader">Malpedia yara</a></li>
<li><a href="https://blog.sekoia.io/privateloader-the-loader-of-the-prevalent-ruzki-ppi-service/">PrivateLoader: the loader of the prevalent ruzki PPI service</a></li>
<li><a href="https://github.com/JustasMasiulis/xorstr">Example string encryption using xorstr</a></li>
</ul>
<h2 id="Sample">
<a class="anchor" href="#Sample" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample<a class="anchor-link" href="#Sample"> </a>
</h2>
<ul>
<li>
<code>2cd2f077ca597ad0ef234a357ea71558d5e039da9df9958d0b8bd0efa92e74c9</code><a href="https://www.unpac.me/results/31bbf769-34dc-4d9c-af52-721c61853713?hash=2cd2f077ca597ad0ef234a357ea71558d5e039da9df9958d0b8bd0efa92e74c9#/">UnpacMe</a>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Analysis">
<a class="anchor" href="#Analysis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Analysis<a class="anchor-link" href="#Analysis"> </a>
</h2>
<p>Both PrivateLoader and RisePRO use the same plaintext user agent string <code>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36</code> and request header <code>"Content-Type: application/x-www-form-urlencoded"</code> also the string encryption algorithm is the same (xmm registers and xor intrinsic). Funny enough this causes a 100% overlap between the PrivateLoader Yara rule and RisePro.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Yara-Rule">
<a class="anchor" href="#Yara-Rule" aria-hidden="true"><span class="octicon octicon-link"></span></a>Yara Rule<a class="anchor-link" href="#Yara-Rule"> </a>
</h3>
<p>PrivateLoader yara rule matches on both PrivateLoader and RisePRO!</p>

<pre><code>rule win_privateloader_w0 {
  meta:
    author =    "andretavare5"
    org =       "BitSight"
    date =      "2022-06-06"
    md5 =       "8f70a0f45532261cb4df2800b141551d"
    reference = "https://tavares.re/blog/2022/06/06/hunting-privateloader-pay-per-install-service"
    license =   "CC BY-NC-SA 4.0"

    malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.privateloader"
    malpedia_version = "20220824"
    malpedia_license = "CC BY-NC-SA 4.0"
    malpedia_sharing = "TLP:WHITE"
  strings:
    $code = { 66 0F EF (4?|8?) } // pxor xmm(1/0) - str chunk decryption
    $str =  "Content-Type: application/x-www-form-urlencoded" wide ascii
    $ua1 = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36" wide ascii
    $ua2 = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36" wide ascii

  condition:
    uint16(0) == 0x5A4D and // MZ
    $str and
    any of ($ua*) and
    #code &gt; 100
}</code></pre>
<p>We need new Yara rules for both PrivateLoader and RisePRO to differentiate the two.</p>
<h3 id="C2">
<a class="anchor" href="#C2" aria-hidden="true"><span class="octicon octicon-link"></span></a>C2<a class="anchor-link" href="#C2"> </a>
</h3>
<p>The C2 domain is stored in plain text in RisePRO unlike PrivateLoader (where it is encrypted).</p>

<pre><code>194.169.175[.]128</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="String-Decryption">
<a class="anchor" href="#String-Decryption" aria-hidden="true"><span class="octicon octicon-link"></span></a>String Decryption<a class="anchor-link" href="#String-Decryption"> </a>
</h2>
<p>There are encrypted stack strings that are composed of the string data, and an accompanying XOR key. These are loaded onto the stack, then directly XOR decrypted.</p>
<h3 id="X-Junior-IDA-Script">
<a class="anchor" href="#X-Junior-IDA-Script" aria-hidden="true"><span class="octicon octicon-link"></span></a>X-Junior IDA Script<a class="anchor-link" href="#X-Junior-IDA-Script"> </a>
</h3>
<p><a href="https://github.com/X-Junior">X-Junior</a> has a script that we can try in IDA to decrypt these strings: <a href="https://github.com/X-Junior/Malware-IDAPython-Scripts/tree/main/PivateLoader">GitHub Repo</a>.</p>
<h3 id="Andre-Tavares-Python-Script">
<a class="anchor" href="#Andre-Tavares-Python-Script" aria-hidden="true"><span class="octicon octicon-link"></span></a>Andre Tavares Python Script<a class="anchor-link" href="#Andre-Tavares-Python-Script"> </a>
</h3>
<p><a href="https://gist.github.com/andretavare5">andretavare5</a> has a python script using capstone to decrypt the strings: <a href="https://gist.github.com/andretavare5/66ec413cdb4c7c39d35c22d38c7067a8#file-privateloader_str_decrypt-py">Script Gist</a>.</p>
<p>We have created our own hybrid of the two, which uses capstone for disassembly, but implements the logic from the IDA script...</p>
<h3 id="XorStr-Library">
<a class="anchor" href="#XorStr-Library" aria-hidden="true"><span class="octicon octicon-link"></span></a>XorStr Library<a class="anchor-link" href="#XorStr-Library"> </a>
</h3>
<p>The string decryption looks a lot like this open source library <a href="https://github.com/JustasMasiulis/xorstr">xorstr</a>. The following is an example of the library in use.</p>

<pre><code>.text:00411E14 C7 44 24 08 25 7B 87 92                       mov     [esp+60h+var_58], 92877B25h
.text:00411E1C 0F 57 C0                                      xorps   xmm0, xmm0
.text:00411E1F C7 44 24 0C B6 10 A7 1F                       mov     [esp+60h+var_54], 1FA710B6h
.text:00411E27 8B 44 24 08                                   mov     eax, [esp+60h+var_58]
.text:00411E2B 8B 4C 24 0C                                   mov     ecx, [esp+60h+var_54]
.text:00411E2F 89 44 24 10                                   mov     dword ptr [esp+60h+var_50], eax
.text:00411E33 89 4C 24 14                                   mov     dword ptr [esp+60h+var_50+4], ecx
.text:00411E37 C7 44 24 08 D1 77 20 5B                       mov     [esp+60h+var_58], 5B2077D1h
.text:00411E3F C7 44 24 0C C5 36 32 7E                       mov     [esp+60h+var_54], 7E3236C5h
.text:00411E47 8B 44 24 08                                   mov     eax, [esp+60h+var_58]
.text:00411E4B 8B 4C 24 0C                                   mov     ecx, [esp+60h+var_54]
.text:00411E4F 89 44 24 18                                   mov     dword ptr [esp+60h+var_50+8], eax
.text:00411E53 89 4C 24 1C                                   mov     dword ptr [esp+60h+var_50+0Ch], ecx
.text:00411E57 C7 44 24 08 6D 1E EB FE                       mov     [esp+60h+var_58], 0FEEB1E6Dh
.text:00411E5F C7 44 24 0C D9 3C 87 48                       mov     [esp+60h+var_54], 48873CD9h
.text:00411E67 8B 44 24 08                                   mov     eax, [esp+60h+var_58]
.text:00411E6B 8B 4C 24 0C                                   mov     ecx, [esp+60h+var_54]
.text:00411E6F C7 44 24 08 BE 05 4C 3F                       mov     [esp+60h+var_58], 3F4C05BEh
.text:00411E77 89 44 24 40                                   mov     dword ptr [esp+60h+var_20], eax
.text:00411E7B C7 44 24 0C E4 36 32 7E                       mov     [esp+60h+var_54], 7E3236E4h
.text:00411E83 8B 44 24 08                                   mov     eax, [esp+60h+var_58]
.text:00411E87 89 4C 24 44                                   mov     dword ptr [esp+60h+var_20+4], ecx
.text:00411E8B 8B 4C 24 0C                                   mov     ecx, [esp+60h+var_54]
.text:00411E8F 89 44 24 48                                   mov     dword ptr [esp+60h+var_20+8], eax
.text:00411E93 8D 44 24 10                                   lea     eax, [esp+60h+var_50]
.text:00411E97 89 4C 24 4C                                   mov     dword ptr [esp+60h+var_20+0Ch], ecx
.text:00411E9B 8D 50 01                                      lea     edx, [eax+1]
.text:00411E9E 0F 28 4C 24 40                                movaps  xmm1, [esp+60h+var_20]
.text:00411EA3 66 0F EF 4C 24 10                             pxor    xmm1, [esp+60h+var_50]
.text:00411EA9 0F 29 4C 24 10                                movaps  [esp+60h+var_50], xmm1
.text:00411EAE 0F 29 44 24 20                                movaps  [esp+60h+var_40], xmm0
.text:00411EB3 C7 44 24 30 00 00 00 00                       mov     [esp+60h+var_30], 0
.text:00411EBB C7 44 24 34 00 00 00 00                       mov     [esp+60h+var_2C], 0</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="String-Extraction">
<a class="anchor" href="#String-Extraction" aria-hidden="true"><span class="octicon octicon-link"></span></a>String Extraction<a class="anchor-link" href="#String-Extraction"> </a>
</h3>
<p>The string encryption is almost identical to privateloader, we had to adjust for registers that store immediates for multiple strings in a row. Also, there are situations where the stack string DWORDs are not combined in order. Currently we don't handle this, but the solution is to use the <code>.dis</code> memory displacement to determine the order of the the DWORDs.</p>
<h3 id="Samples">
<a class="anchor" href="#Samples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Samples<a class="anchor-link" href="#Samples"> </a>
</h3>
<ul>
<li>maybe cheat<ul>
<li><code>92394d5c170060b09ba4ffba450f44d5d4387693a00ee1aba910a818fa387b3192394d5c170060b09ba4ffba450f44d5d4387693a00ee1aba910a818fa387b31</code></li>
</ul>
</li>
<li>metastealer<ul>
<li><code>6cf8bfba1b221effcb1eccec0c91fb0906d0b8996932167f654680cb3ac53aac6cf8bfba1b221effcb1eccec0c91fb0906d0b8996932167f654680cb3ac53aac</code></li>
</ul>
</li>
<li>meduza stealer x64<ul>
<li><code>2ad84bfff7d5257fdeb81b4b52b8e0115f26e8e0cdaa014f9e3084f518aa61492ad84bfff7d5257fdeb81b4b52b8e0115f26e8e0cdaa014f9e3084f518aa6149</code></li>
</ul>
</li>
<li>meduza stealer x32<ul>
<li><code>29cf1ba279615a9f4c31d6441dd7c93f5b8a7d95f735c0daa3cc4dbb799f66d429cf1ba279615a9f4c31d6441dd7c93f5b8a7d95f735c0daa3cc4dbb799f66d4</code></li>
</ul>
</li>
<li>mpress unpacked risepro<ul>
<li><code>16ae203879efe1912bb8b97ceb0f4645abcde27a987e98a171d59f9c1ec3f76416ae203879efe1912bb8b97ceb0f4645abcde27a987e98a171d59f9c1ec3f764</code></li>
</ul>
</li>
<li>privateloader<ul>
<li><code>1aa2d32ab883de5d4097a6d4fe7718a401f68ce95e0d2aea63212dd9051039481aa2d32ab883de5d4097a6d4fe7718a401f68ce95e0d2aea63212dd905103948</code></li>
</ul>
</li>
<li>rise pro<ul>
<li><code>2cd2f077ca597ad0ef234a357ea71558d5e039da9df9958d0b8bd0efa92e74c92cd2f077ca597ad0ef234a357ea71558d5e039da9df9958d0b8bd0efa92e74c9</code></li>
</ul>
</li>
</ul>
<h3 id="Decryption-Algorithm">
<a class="anchor" href="#Decryption-Algorithm" aria-hidden="true"><span class="octicon octicon-link"></span></a>Decryption Algorithm<a class="anchor-link" href="#Decryption-Algorithm"> </a>
</h3>
<ul>
<li>select the first section in the PE file, assume this is the code</li>
<li>scan code for final <code>pxor</code> instruction and truncate at this instruction to remove extra code from scanning (handle packers with large first sections)</li>
<li>linear disassemble the full code block - <strong>not efficient</strong>
</li>
<li>traverse assembly until <code>pxor</code> instruction is located</li>
<li>scan backwards until all immediate data is located for the <code>xmm</code> registers</li>
<li>decrypt xmm data, this is the string chunk</li>
<li>keep running tally of string chunks and combine if no instructions separate them </li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">unhex</span><span class="p">(</span><span class="n">hex_string</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">binascii</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">hex_string</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">hex_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">hex_string</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tohex</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">binascii</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pefile</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">from</span> <span class="nn">capstone</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">capstone.x86</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>


<span class="k">def</span> <span class="nf">is_ascii</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">128</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)])</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">get_reg_data</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">reg_name</span><span class="p">):</span>
    <span class="n">search_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">search_limit</span> <span class="o">=</span> <span class="mi">2000</span>
    <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">instructions</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">search_count</span> <span class="o">&gt;</span> <span class="n">search_limit</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">search_count</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">if</span>  <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'mov'</span> <span class="ow">and</span>  <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span>  <span class="ow">and</span>  <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_IMM</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">reg_name</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reg</span><span class="p">)</span> <span class="o">==</span> <span class="n">reg_name</span><span class="p">:</span>
                <span class="n">imm_value</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">imm</span>
                <span class="n">data_chunk</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;I'</span><span class="p">,</span><span class="n">imm_value</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">data_chunk</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">instructions</span><span class="p">):</span>
    <span class="n">data_chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">steps_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">flag_reg</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">search_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">search_limit</span> <span class="o">=</span> <span class="mi">400</span>
    
    <span class="k">for</span> <span class="n">inst_ptr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">instructions</span><span class="p">)):</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">instructions</span><span class="p">[</span><span class="n">inst_ptr</span><span class="p">]</span>
        <span class="n">steps</span> <span class="o">+=</span><span class="mi">1</span>
        
        <span class="k">if</span> <span class="n">search_count</span> <span class="o">&gt;</span> <span class="n">search_limit</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">search_count</span> <span class="o">+=</span> <span class="mi">1</span>
         
        <span class="k">if</span>  <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'call'</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="k">if</span>  <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'mov'</span> <span class="ow">and</span>  <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span>  <span class="ow">and</span>  <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_IMM</span><span class="p">:</span>
            <span class="n">flag_reg</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="c1"># if  inst.mnemonic == 'mov' and inst.operands[0].type == X86_OP_MEM and inst.operands[1].type == X86_OP_REG:</span>
        <span class="c1">#     reg_name = inst.reg_name(inst.operands[1].reg)</span>
        <span class="c1">#     #print(f"Scanning for {reg_name} data....")</span>
        <span class="c1">#     result = get_reg_data(instructions[inst_ptr:], reg_name)</span>
        <span class="c1">#     if result is None:</span>
        <span class="c1">#         #print("scanning failed")</span>
        <span class="c1">#         break</span>
        <span class="c1">#     #print(f"Found reg {reg_name} data {result}")</span>
        <span class="c1">#     data_chunks.append(result)</span>
        <span class="c1">#     count += 1</span>
        <span class="c1">#     steps = 0</span>
        <span class="c1">#     steps_flag = 1</span>
         
        <span class="k">if</span>  <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'mov'</span> <span class="ow">and</span> <span class="p">(</span> <span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">disp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span> <span class="p">)</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_IMM</span><span class="p">:</span>
            <span class="n">imm_value</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">imm</span>
            <span class="c1">#print(hex(imm_value))</span>
            <span class="k">if</span> <span class="n">imm_value</span> <span class="o">&amp;</span> <span class="mh">0xff000000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">data_chunk</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;I'</span><span class="p">,</span><span class="n">imm_value</span><span class="p">)</span>
            <span class="n">data_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_chunk</span><span class="p">)</span>

            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">steps</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">steps_flag</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">steps</span> <span class="o">==</span> <span class="mi">16</span> <span class="ow">and</span> <span class="n">steps_flag</span><span class="p">:</span>
            <span class="k">break</span>
         <span class="c1">#if steps == 6 and steps_flag:  # if you got some garbage string use this instead of the above</span>
            <span class="c1">#break</span>
       
    
    <span class="n">enc_data</span> <span class="o">=</span> <span class="n">data_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">count</span><span class="o">//</span><span class="mi">2</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">data_chunks</span><span class="p">[</span><span class="n">count</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span><span class="n">count</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">flag_reg</span> <span class="p">:</span>
        <span class="n">enc_data</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">enc_data</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">enc_data</span><span class="p">[::</span><span class="mi">2</span><span class="p">]),</span> <span class="p">())</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">],</span> <span class="n">key</span><span class="p">[::</span><span class="mi">2</span><span class="p">]),</span> <span class="p">())</span>
    <span class="k">return</span> <span class="sa">b</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">enc_data</span><span class="p">),</span><span class="sa">b</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">get_strings_from_inst</span><span class="p">(</span><span class="n">instructions</span><span class="p">):</span>
    <span class="c1"># search, build and decrypt strings</span>
    <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">string</span> <span class="o">=</span> <span class="s1">''</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">inst</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">instructions</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'pxor'</span><span class="p">:</span>
        <span class="c1"># if inst.address == 0x0045C8A0:</span>
            <span class="c1">#print(hex(inst.address))</span>
            <span class="c1">#try: # possible string decryption found  </span>
            <span class="n">reversed_instruction_list</span> <span class="o">=</span> <span class="n">instructions</span><span class="p">[:</span><span class="n">i</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">encrypted_str</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">reversed_instruction_list</span><span class="p">)</span>
            <span class="c1"># print(f"str_len: {len(encrypted_str)}, key_len: {len(key)}")</span>
            <span class="c1"># print(encrypted_str.hex())</span>
            <span class="c1"># print(key.hex())</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">encrypted_str</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1">#print(f"Error at {hex(inst.address)} key or data is missing")</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">encrypted_str</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="c1">#print(f"Error at {hex(inst.address)} key and data not equal length")</span>
                <span class="k">continue</span>

            <span class="n">out</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">encrypted_str</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">^</span> <span class="n">key</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>

            <span class="c1">#print(out)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">,</span><span class="sa">b</span><span class="s1">''</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1">#print(out.decode('utf-8'))</span>

            <span class="k">if</span> <span class="n">is_ascii</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>
                <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">,</span><span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">strings</span>


<span class="n">SAMPLE_PATH</span> <span class="o">=</span> <span class="s1">'/tmp/maybecheat.bin'</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">SAMPLE_PATH</span>
<span class="n">pe</span> <span class="o">=</span> <span class="n">pefile</span><span class="o">.</span><span class="n">PE</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="c1"># Assume the first section is code</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># TODO: we don't seem to be disassembling the full section?!!</span>
<span class="n">image_base</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">OPTIONAL_HEADER</span><span class="o">.</span><span class="n">ImageBase</span>
<span class="n">section_rva</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">VirtualAddress</span>
<span class="n">section_offset</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">PointerToRawData</span>

<span class="n">section_data</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

<span class="n">pxor_egg</span> <span class="o">=</span> <span class="sa">rb</span><span class="s1">'\x66\x0F\xEF'</span>
<span class="n">scan_end</span> <span class="o">=</span> <span class="n">section_data</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">pxor_egg</span><span class="p">)</span>

<span class="n">section_data</span> <span class="o">=</span> <span class="n">section_data</span><span class="p">[:</span><span class="n">scan_end</span><span class="p">]</span>



<span class="c1"># disassemble .txt section</span>
<span class="n">pe</span> <span class="o">=</span> <span class="n">pefile</span><span class="o">.</span><span class="n">PE</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">md</span> <span class="o">=</span> <span class="n">Cs</span><span class="p">(</span><span class="n">CS_ARCH_X86</span><span class="p">,</span> <span class="n">CS_MODE_32</span><span class="p">)</span> 
<span class="n">md</span><span class="o">.</span><span class="n">detail</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">md</span><span class="o">.</span><span class="n">skipdata</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">addr</span> <span class="o">=</span> <span class="mi">0</span>



<span class="c1">## Time starts</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="c1"># instructions = []</span>
<span class="c1"># for inst in md.disasm(section_data, image_base + section_rva):</span>
<span class="c1">#     instructions.append(inst)</span>

<span class="c1"># strings = get_strings_from_inst(instructions)</span>

<span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pxor_egg</span><span class="p">,</span> <span class="n">section_data</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">):</span>
    <span class="n">scan_end</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">instructions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">md</span><span class="o">.</span><span class="n">disasm</span><span class="p">(</span><span class="n">section_data</span><span class="p">[</span><span class="n">scan_end</span><span class="o">-</span><span class="mh">0x400</span><span class="p">:</span><span class="n">scan_end</span><span class="p">],</span> <span class="n">image_base</span> <span class="o">+</span> <span class="n">section_rva</span> <span class="o">+</span> <span class="n">scan_end</span> <span class="o">-</span> <span class="mh">0x400</span><span class="p">):</span>
        <span class="n">instructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
    <span class="n">strings</span> <span class="o">+=</span> <span class="n">get_strings_from_inst</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>




<span class="c1"># Benchmark 50.47584390640259 metastealer    </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Benchmark </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                           
<span class="c1"># print(len(strings))</span>
<span class="n">string_dict</span> <span class="o">=</span> <span class="p">{}</span>  
<span class="n">last_string</span> <span class="o">=</span> <span class="s1">''</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">last_string</span> <span class="o">!=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">string_dict</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">last_string</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">string_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">string_dict</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="c1">#enc string</span>
<span class="c1"># D2 EA F6 5F</span>
<span class="c1"># 9A 2F 1D 5C               </span>
<span class="c1"># 3B A0 36 4E                </span>
<span class="c1"># F0 81 B8 52                 </span>
 
<span class="c1"># key</span>
<span class="c1"># B7 92 86 36</span>
<span class="c1"># E8 4E 69 35</span>
<span class="c1"># 54 CE 69 37</span>
<span class="c1"># 95 E0 CA 52   </span>
    
<span class="nb">print</span><span class="p">(</span><span class="s2">"done"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Benchmark 2.145430088043213
0x10061eea KeyValuesSystem
0x10061f3a vstdlib.dllKeyValuesSystem
0x1006205b KeyValuesSystem
K?stem =
0x100621cc KeyValuesSystem
K?stem =
0x1006233d KeyValuesSystem
0x10077f1a C:/windows/fonts/segoeui.ttf
0x100784f7 Head
0x1007855d BodyHead
0x100785c0 	Body
0x10078631 ArmsHead


0x10078e20 Automatic stop
0x10078e82 Force accuracy
0x10078eea  accuracy
0x10078f8d Select
0x10078fe1 

ions
0x100790cb Automatic Scope
0x1007917d %.2f
0x100794fe Damage Override
0x100792ac %.2f
0x1007942f %.2f
0x10079629 Select
0x1007966e HitboxesSelect
0x100799e7 Select
0x10079a3b MultipointsSelect
0x10079dd9 Select
0x10079e2d Safe HitboxesSelect
0x10079f01 Safe Points
0x1007a7c8 %.2f
0x1007a909  DelvF]ay
0x1007a993 %.2f
0x1007a9f5 FOVRCS 
0x1007aa82 %.2f
0x1007aae4 SmooRCS th
0x1007a8bc %.2f
0x1007ab7a XRCS 
0x1007ac04 RCS Y
0x1007ae26 Nearest
0x1007aecb Head
0x1007af2b Body
0x1007af93 Pelvis
0x1007aff6 Select
0x1007b03b es
0x1007b12c %.2f
0x1007b1fa Dynamic FOV
0x1007b261 %.2f
0x1007b338 Auto Wall
0x1007b3a8 %.2f
0x1007b508 Legit Checks
Local7bca9 Enemy
0x1007bd4a M-a3N# aBNal
0x1007be35 Enable
0x1007bec9 Only Visible
0x1007bf50 Dormant
0x1007bfee Select
0x1007c045 ect
0x1007c0d1 Box
0x1007c229 box_settings_player
0x1007c2fb ##esp_box_settings
0x1007c50a Box Style##box_style
0x1007c577 Visible
0x1007c3c3 ##esp_box_settings
0x1007c662 Color Box Visible
0x1007c6db Invisible
0x1007c7c6 Color Box inVisible
0x1007c845 Fill
0x1007c919 Gradient##esp_box_filled_fade
0x1007c9a4 Name
0x1007caff name_settings_player
0x1007cbd1 ##esp_name_settings
0x1007cdad  
0x1007ceff Weapon Icon
0x1007d060 weapon__ico_settings_player
0x1007ce72  
0x1007d12c ##esp_weapon_i_settings
0x1007d2e3 Font size##w_i
0x1007d363  
0x1007d1e7 ##esp_weapon_i_settings
0x1007d3d3 Color
0x1007d4bb Color Weapon##2323232
0x1007d535  
0x1007d5c2 Weapon Text
0x1007d720 weapon__settings_player
0x1007d7ec ##esp_weapon__settings
0x1007d9a3 Font size##w_
0x1007da23  
0x1007d8a7 ##esp_weapon__settings
0x1007da93 Color
0x1007db7b Color Weapon##wewe
0x1007dbf5  
0x1007dc82 Ammo Text
0x1007dde0 ammo__settings_player
0x1007deac ##esp_ammo__settings
0x1007e0ba Font size##ammo_
0x1007e13a  
0x1007df67 ##esp_ammo__settings
0x1007e1aa Color
0x1007e292 Color Ammo##retrtertertr
0x1007e30c  
0x1007e399 Health Text
0x1007e4f7 health__settings_player
0x1007e5c3 ##esp_health__settings
0x1007e7d1 Font size##health_
0x1007e84e  
0x1007e67e ##esp_health__settings
0x1007e8be Color
0x1007e9a9 Color health##retrtertertr
0x1007ea20  
0x1007eaad Money Text
0x1007ec0e money__settings_player
0x1007ecda ##esp_money__settings
0x1007eee8 Font size##money_
0x1007ef68  
0x1007ed95 ##esp_money__settings
0x1007efd8 Color
0x1007f0c0 Color money##retrtertertr
0x1007f13a  
0x1007f1c7 Flashed Text
0x1007f325 flashed__settings_player
0x1007f3f1 ##esp_flashed__settings
0x1007f5ff Font size##flashed_
0x1007f67f  
0x1007f4ac ##esp_flashed__settings
0x1007f6ef Color
0x1007f7d7 Color flashed##retrtertertr
0x1007f851  
0x1007f8de Reloading Text
0x1007fa3c reloading__settings_player
0x1007fb08 ##esp_reloading__settings
0x1007fd16 Font size##reloading_
0x1007fd96  
0x1007fbc3 ##esp_reloading__settings
0x1007fe06 Color
0x1007feee Color reloading##retrtertertr
0x1007ff68  
0x1007fff5 Scoped Text
0x10080153 scoped__settings_player
0x1008021f ##esp_scoped__settings
0x1008042d Font size##scoped_
0x100804aa  
0x100802da ##esp_scoped__settings
0x1008051a Color
0x10080605 Color scoped##retrtertertr
0x1008067c  
0x10080709 Armor Text
0x1008086a armor__settings_player
0x10080936 ##esp_armor__settings
0x10080b44 Font size##armor_
0x10080bc4  
0x100809f1 ##esp_armor__settings
0x10080c34 Color
0x10080d1c Color armor##retrtertertr
0x10080d96  
0x10080e23 Defuser Text
0x10080f81 defuser__settings_player
0x1008104d ##esp_defuser__settings
0x1008125b Font size##defuser_
0x100812db  
0x10081108 ##esp_defuser__settings
0x1008134b Color
0x10081433 Color defuser##retrtertertr
0x100814ad  
0x1008153a Health Bar
0x10081698 health_color_player
0x10081764 ##esp_health_color_settings
0x100818a0 Color
0x10081931 Color health
0x100819ab  
0x1008181f ##esp_health_color_settings
0x10081a38 Out Of Fov
0x10081b96 oof_settings_player
0x10081c07 ##oof_settings
0x10081cec Color
0x10081d7d Color OOF
0x10081df7  
0x10081c6b ##oof_settings
0x10081f2d Style##oof_style
0x10082005 Chams
0x1008233a Enable Chams
0x100823e6 ##qweqwe
0x10082580 Material
0x10082606 Outline
0x10082690 ##512414 color
0x10082775 Transparency
0x1008289c AdditionalLegitbot
0x100829d2 Line
0x10082b18 Circle
0x10082c5e Damage
0x10082ed8 Molotov
0x10082fc7 Smoke
0x1008310b View
0x100832e9 FOV_Changer_player
0x10083354 ##FOV_Changer
0x10083526  
0x10083599 %.2f
0x100835f0 fO_ra
0x1008367e  
0x1008380a Offset_player
0x100838d0 ##Offset_Changer
0x10083af9  
0x10083b6c %.2f
0x1008398b ##Offset_Changer
0x10083bc3 |.2f
0x10083c51  
0x10083e14 %.2f
0x10083e87 Roll
0x10083f01  
0x10084155 Freecam_player
0x1008421b ##Freecamq_Changer
0x10084441  
0x100844ac Bind
0x100842d6 ##Freecamq_Changer
0x1008450c freecam_bind
0x100845dc PreviewEsp
0x100847c4 Select
0x1008481b 
ls
0x10084cc1 Bind
0x10085062 Color
0x100851e9 Fog_player
0x100852af ##Fogset_Changer
0x100853eb Color
0x100854e5  
0x1008554a %.2f
0x1008536a ##Fogset_Changer
0x1008568f  
0x10085bec Modulation
0x100859e3  
0x10085c70 oxSkyb
0x10085de6 World_player
0x10085e5e ##World_Changer
0x10085eeb World
0x10085fe2  
0x1008604d Props
0x10086127 r StColo Proaticps
0x1008619e  
0x10086209 Sky
0x10086303  
0x1008648e Post_player
0x100864fd ##Post_Changer
0x1008658a Color
0x10086684  
0x1008691b %.2f
0x100870d4 Manual Left
0x10087184 Manual Back
0x10087234 Manual Right
0x1008735c Inverter Key
0x1008740c Slow walk Key
0x100878b6 Select
Straight8e Disabled
0x100889d7 Fake Duck
0x10088ac4 Auto-Peek
0x10088c4c AdditionalLegitbot
reak lisSpamtR!Esaat b
Valveted81 Static
0x10089150 TargetingLegitbot
0x1008921f Profile
0x10089288 Off
0x100892eb  Rat 1
0x1008934e OffLab Rat 2Lab Rat 1
aRw) 2R#O/O_fT-W*Ge-
0x1008994e Wildfire Wolf
0x10089b31 Silver II
0x10089b94 I
0x10089bf7 Silver IISilver IVSilver III
0x10089c5a % te
0x10089e3d Gold Nova III
0x10089ef7 Gold Nova Master
0x10089fb1 
E&lt;O1A?RI
0x1008a06b Gold Nova MasterMaster Guardian IIMaster Guardian I
0x1008a125 
E&lt;O1A?RIIlite
0x1008a1df Gold Nova MasterMaster Guardian EliteMaster Guardian IDistinguished Master GuardianMaster Guardian II
0x10089f82 IMaster Guardian 
0x1008a03c IIMaster Guardian 
0x1008a0f6 %ite
0x1008a1b0 EliteMaster Guardian IIDistinguished Master GuardianMaster Guardian 
0x1008a3be Supreme Master First Class
0x1008a7a4 Update All
0x1008a89d Profile 2
Greenwabd4 None
0x1008ad84 Render
0x1008afc6 dmg_ind_s_settings
0x1008b08c ##dmg_ind_settings
0x1008b1d5 Color
0x1008b33a %.2f
0x1008b154 ##dmg_ind_settings
0x1008b391 v^Wd
0x1008b41a  
0x1008b49a %.2f
0x1008b4f8 cA\ size
0x1008b572  
0x1008b79f Penetration_s_settings
0x1008b877 ##Penetration_ind_settings
0x1008bcbf Hit_ind_s_settings
0x1008bad5 Type##misc_Penetration_tag_type
0x1008bd85 ##Hit_ind_settings
0x1008bf3a Color
0x1008be4d ##Hit_ind_settings
0x1008c08b  
0x1008c167 Color
0x1008c2b8  
0x1008c4a0 spread_settings
0x1008c566 ##spread_cross_settings
0x1008c6a2 Color
0x1008c7f3  
0x1008c621 ##spread_cross_settings
0x1008cb64 aimfov_settings
0x1008c9dd  
0x1008cc2a ##aimfov_cross_settings
0x1008cd66 Color
0x1008ce60  
0x1008cce5 ##aimfov_cross_settings
Filled Circlercle
0x1008d04a  
0x1008d10b Beams
0x1008d2e9 bullet_t_settings
0x1008d3af ##bullet_settings
0x1008d557 Enemy Color
0x1008d46a ##bullet_settings
0x1008d6a8  
0x1008d8ac Local Color
0x1008d9fd  
0x1008d7d6 Type##enemy_tracers_type
0x1008dd10 ImpactsImpacts_settings
0x1008ddd6 ##Impacts_settings
0x1008df7e Server
0x1008e063  
0x1008de91 ##Impacts_settings
0x1008e0c8 Local Impacts
0x1008e13a Local
0x1008e234  
0x1008e303 Patches
0x1008e98b  AfkAntik Kic
0x1008ea3e Window
0x1008ebd2 ex_b_settings
0x1008ec3d ##ex_settings
0x1008edff  
0x1008eca1 ##ex_settings
0x1008ef86 hits_settings
0x1008f04c ##hits1_settings
0x1008f275  
0x1008f2ed Hit
0x1008f107 ##hits1_settings
0x1008f350 e
0x1008f3b3 HitTeam takeTake
0x1008f416 m takehases
0x1008f479 HitPurchasesTakeBombTeam take
0x1008f4dc chases take
0x1008f582 Select
0x1008f5d9 
ect
0x1008fad1 radar_settings
0x1008fbac ##radar_cross_settings
0x1008fce8 CT Visible
0x1008fe2e T Visible
0x1008fc67 ##radar_cross_settings
0x1008fff5 CT Invisible
0x1009013b T Invisible
0x10090359 Color
0x10090476  
0x1009064d buybot
0x10090567  
0x10090a37 ndarSecoy
0x10090ab8 Select
0x100914a9 Name Config
0x10091570 Create Config
0x10091789 Load Config
0x100918e6 cfg_player
0x10091972 ##cfg_settings
0x10091af7 Load Rage
0x10091bbf  
0x10091c18 Load Anti-Aims
0x10091cd6  
0x10091d2f Load Legit
0x10091ded  
0x10091e46 Load Visuals
0x10091f04  
0x10091f5d Load Misc
0x1009201b  
0x10092074 Load Inventory
0x10092132  
0x1009219f Save Config
0x100922c1 Rename Config
0x1009243a Delete Config
0x1009252d Open CFG Folder
0x10093417 Tap on item to remove
0x100936a4  | 
0x10093a21 Select
0x10093a72 ct
0x10093cf6 Default
0x100954a3 Select
0x10096bec GAME
0x100976cd 5AME
0x1009766f GAME
0x1009772b GAMEr
0x10097c0f Add
0x100d9aa3 serverbrowser.dll
0x100d9b5f d1gital
0x100f3b5e sv_client_max_interp_ratio
done
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">string_start</span> <span class="o">=</span> <span class="mh">0x0045C1D3</span>
<span class="n">test_addr</span> <span class="o">=</span> <span class="mh">0x0045C8A0</span> 
<span class="n">test_rva</span> <span class="o">=</span> <span class="n">test_addr</span> <span class="o">-</span> <span class="n">image_base</span>
<span class="n">test_offset</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">get_offset_from_rva</span><span class="p">(</span><span class="n">test_rva</span><span class="p">)</span>

<span class="n">test_addr</span> <span class="o">-</span> <span class="n">string_start</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1741</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">ida_to_dmp_rva</span><span class="p">(</span><span class="n">ida_addr</span><span class="p">,</span> <span class="n">image_base</span><span class="p">,</span> <span class="n">dump_image_base</span><span class="p">):</span>
    <span class="n">ida_rva</span> <span class="o">=</span> <span class="n">ida_addr</span> <span class="o">-</span> <span class="n">image_base</span>
    <span class="k">return</span> <span class="n">ida_rva</span> <span class="o">+</span> <span class="n">dump_image_base</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dumpulator</span> <span class="kn">import</span> <span class="n">Dumpulator</span>

<span class="n">dp</span> <span class="o">=</span> <span class="n">Dumpulator</span><span class="p">(</span><span class="s2">"/tmp/rise.dmp"</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">main_addr</span> <span class="o">=</span> <span class="mh">0x00458C9B</span>
<span class="n">main_rva</span> <span class="o">=</span> <span class="n">main_addr</span> <span class="o">-</span> <span class="n">image_base</span>
<span class="n">dump_image_base</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">main</span>
<span class="n">main_dump_addr</span> <span class="o">=</span> <span class="n">main_rva</span> <span class="o">+</span> <span class="n">dump_image_base</span>


<span class="n">dp</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">dp</span><span class="o">.</span><span class="n">regs</span><span class="o">.</span><span class="n">rip</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">main_dump_addr</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"done"</span><span class="p">)</span>




<span class="k">def</span> <span class="nf">read_std_string</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
    <span class="n">str_out</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">''</span>
    <span class="n">str_size</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">read_long</span><span class="p">(</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">str_size</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">:</span>
        <span class="n">str_ptr</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">read_ptr</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
        <span class="n">str_data</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">str_ptr</span><span class="p">,</span> <span class="n">str_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">str_data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">str_out</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">read_str</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">str_out</span>
    

<span class="n">global_str_addr</span> <span class="o">=</span> <span class="n">ida_to_dmp_rva</span><span class="p">(</span><span class="mh">0x004F06B0</span><span class="p">,</span> <span class="n">image_base</span><span class="p">,</span> <span class="n">dp</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">read_std_string</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">global_str_addr</span><span class="p">))</span>

<span class="n">global_str_addr</span> <span class="o">=</span> <span class="n">ida_to_dmp_rva</span><span class="p">(</span><span class="mh">0x004F06E0</span><span class="p">,</span> <span class="n">image_base</span><span class="p">,</span> <span class="n">dp</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">read_std_string</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">global_str_addr</span><span class="p">)</span>

    
<span class="n">global_str_addr</span> <span class="o">=</span> <span class="n">ida_to_dmp_rva</span><span class="p">(</span><span class="mh">0x04F07DC</span><span class="p">,</span> <span class="n">image_base</span><span class="p">,</span> <span class="n">dp</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">read_std_string</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">global_str_addr</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>commit(0x6b6000[0x1000], PAGE_READWRITE)
commit(0x6b7000[0x2000], PAGE_READWRITE)
commit(0x6b9000[0x2000], PAGE_READWRITE)
done
50500
bytearray(b'RisePro\r\nTelegram: https://t.me/RiseProSUPPORT')
</pre>
</div>
</div>

</div>
</div>

</div>
    

</div>



  </div><a class="u-url" href="/risepro/stealer/config/triage/2023/06/15/risepro.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>

<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>XORSTR Generic String Decryption | OALABS Research</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="XORSTR Generic String Decryption" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Writing a generic string decryptor for this open source library" />
<meta property="og:description" content="Writing a generic string decryptor for this open source library" />
<link rel="canonical" href="https://research.openanalysis.net/xorstr/decryption/python/2023/06/25/xorstr.html" />
<meta property="og:url" content="https://research.openanalysis.net/xorstr/decryption/python/2023/06/25/xorstr.html" />
<meta property="og:site_name" content="OALABS Research" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-06-25T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="XORSTR Generic String Decryption" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-06-25T00:00:00-05:00","datePublished":"2023-06-25T00:00:00-05:00","description":"Writing a generic string decryptor for this open source library","headline":"XORSTR Generic String Decryption","mainEntityOfPage":{"@type":"WebPage","@id":"https://research.openanalysis.net/xorstr/decryption/python/2023/06/25/xorstr.html"},"url":"https://research.openanalysis.net/xorstr/decryption/python/2023/06/25/xorstr.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://research.openanalysis.net/feed.xml" title="OALABS Research" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">OALABS Research</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">XORSTR Generic String Decryption</h1><p class="page-description">Writing a generic string decryptor for this open source library</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2023-06-25T00:00:00-05:00" itemprop="datePublished">
        Jun 25, 2023
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      36 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#xorstr">xorstr</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#decryption">decryption</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#python">python</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-left">
            <div class="px-2">
                <a href="https://www.youtube.com/c/OALabs" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/badge/-YouTube-FF0000" alt="Join us on YouTube">
                </a>
            </div>
            <div class="px-2">
                <a href="https://www.twitch.tv/oalabslive" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/twitch/status/oalabslive?style=social" alt="Join us on Twitch">
                </a>
            </div>
            <div class="px-2">
                <a href="https://discord.gg/cw4U3WHvpn" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/badge/-Join Our Discord-blueviolet" alt="Join Discord">
                </a>
            </div>
            <div class="px-2">
                <a href="https://www.patreon.com/oalabs" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/badge/-OALABS Patreon-FF424D" alt="Support us on Patreon">
                </a>
            </div>
          <div class="px-2">

    <a href="https://github.com/OALabs/research/tree/master/_notebooks/2023-06-25-xorstr.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          
          
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Overview">Overview </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Samples">Samples </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Prior-Work">Prior Work </a>
<ul>
<li class="toc-entry toc-h3"><a href="#X-Junior-IDA-Script">X-Junior IDA Script </a></li>
<li class="toc-entry toc-h3"><a href="#Andre-Tavares-Python-Script">Andre Tavares Python Script </a></li>
<li class="toc-entry toc-h3"><a href="#IDA-Xorstr-Decryption-Plugin">IDA Xorstr Decryption Plugin </a></li>
<li class="toc-entry toc-h3"><a href="#aimware_deobf_str">aimware_deobf_str </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Regex-and-Dissassembly-Approach">Regex and Dissassembly Approach </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Decryption-Algorithm">Decryption Algorithm </a></li>
<li class="toc-entry toc-h3"><a href="#Limitations">Limitations </a></li>
<li class="toc-entry toc-h3"><a href="#Possible-Improvements">Possible Improvements </a></li>
<li class="toc-entry toc-h3"><a href="#Speed-Optimizations">Speed Optimizations </a></li>
<li class="toc-entry toc-h3"><a href="#Hard-Limitations">Hard Limitations </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Memory-Only-Emulation-Trace-(@mishap)">Memory-Only Emulation Trace (@mishap) </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2023-06-25-xorstr.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Overview">
<a class="anchor" href="#Overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview<a class="anchor-link" href="#Overview"> </a>
</h2>
<p>The open source string encryption library <a href="https://github.com/JustasMasiulis/xorstr">xorstr</a> has been adopted by multiple malware developers (as well as slight variations on the same technique). The string encryptor makes use of the <code>xmm</code>/<code>ymm</code> registers and <code>pxor</code> <code>pvxor</code> instructions to decrypt stack strings. In the words of the developer...</p>
<ul>
<li>All keys are 64bit and generated during compile time.</li>
<li>Data blocks go in increments of 16 bytes so some space may be wasted.</li>
<li>The code has been crafted so that all the data would be embedded directly into code and not stored on .rdata and such.</li>
<li>
<p>The entirety of string encryption and decryption will be inlined.</p>
<p>The following is an example of the library in use.</p>
</li>
</ul>

<pre><code>.text:00411E14 C7 44 24 08 25 7B 87 92                       mov     [esp+60h+var_58], 92877B25h
.text:00411E1C 0F 57 C0                                      xorps   xmm0, xmm0
.text:00411E1F C7 44 24 0C B6 10 A7 1F                       mov     [esp+60h+var_54], 1FA710B6h
.text:00411E27 8B 44 24 08                                   mov     eax, [esp+60h+var_58]
.text:00411E2B 8B 4C 24 0C                                   mov     ecx, [esp+60h+var_54]
.text:00411E2F 89 44 24 10                                   mov     dword ptr [esp+60h+var_50], eax
.text:00411E33 89 4C 24 14                                   mov     dword ptr [esp+60h+var_50+4], ecx
.text:00411E37 C7 44 24 08 D1 77 20 5B                       mov     [esp+60h+var_58], 5B2077D1h
.text:00411E3F C7 44 24 0C C5 36 32 7E                       mov     [esp+60h+var_54], 7E3236C5h
.text:00411E47 8B 44 24 08                                   mov     eax, [esp+60h+var_58]
.text:00411E4B 8B 4C 24 0C                                   mov     ecx, [esp+60h+var_54]
.text:00411E4F 89 44 24 18                                   mov     dword ptr [esp+60h+var_50+8], eax
.text:00411E53 89 4C 24 1C                                   mov     dword ptr [esp+60h+var_50+0Ch], ecx
.text:00411E57 C7 44 24 08 6D 1E EB FE                       mov     [esp+60h+var_58], 0FEEB1E6Dh
.text:00411E5F C7 44 24 0C D9 3C 87 48                       mov     [esp+60h+var_54], 48873CD9h
.text:00411E67 8B 44 24 08                                   mov     eax, [esp+60h+var_58]
.text:00411E6B 8B 4C 24 0C                                   mov     ecx, [esp+60h+var_54]
.text:00411E6F C7 44 24 08 BE 05 4C 3F                       mov     [esp+60h+var_58], 3F4C05BEh
.text:00411E77 89 44 24 40                                   mov     dword ptr [esp+60h+var_20], eax
.text:00411E7B C7 44 24 0C E4 36 32 7E                       mov     [esp+60h+var_54], 7E3236E4h
.text:00411E83 8B 44 24 08                                   mov     eax, [esp+60h+var_58]
.text:00411E87 89 4C 24 44                                   mov     dword ptr [esp+60h+var_20+4], ecx
.text:00411E8B 8B 4C 24 0C                                   mov     ecx, [esp+60h+var_54]
.text:00411E8F 89 44 24 48                                   mov     dword ptr [esp+60h+var_20+8], eax
.text:00411E93 8D 44 24 10                                   lea     eax, [esp+60h+var_50]
.text:00411E97 89 4C 24 4C                                   mov     dword ptr [esp+60h+var_20+0Ch], ecx
.text:00411E9B 8D 50 01                                      lea     edx, [eax+1]
.text:00411E9E 0F 28 4C 24 40                                movaps  xmm1, [esp+60h+var_20]
.text:00411EA3 66 0F EF 4C 24 10                             pxor    xmm1, [esp+60h+var_50]
.text:00411EA9 0F 29 4C 24 10                                movaps  [esp+60h+var_50], xmm1
.text:00411EAE 0F 29 44 24 20                                movaps  [esp+60h+var_40], xmm0
.text:00411EB3 C7 44 24 30 00 00 00 00                       mov     [esp+60h+var_30], 0
.text:00411EBB C7 44 24 34 00 00 00 00                       mov     [esp+60h+var_2C], 0</code></pre>
<h3 id="Samples">
<a class="anchor" href="#Samples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Samples<a class="anchor-link" href="#Samples"> </a>
</h3>
<ul>
<li>maybe cheat<ul>
<li><code>92394d5c170060b09ba4ffba450f44d5d4387693a00ee1aba910a818fa387b31</code></li>
</ul>
</li>
<li>metastealer<ul>
<li><code>6cf8bfba1b221effcb1eccec0c91fb0906d0b8996932167f654680cb3ac53aac</code></li>
</ul>
</li>
<li>meduza stealer x64<ul>
<li><code>2ad84bfff7d5257fdeb81b4b52b8e0115f26e8e0cdaa014f9e3084f518aa6149</code></li>
</ul>
</li>
<li>meduza stealer x32<ul>
<li><code>29cf1ba279615a9f4c31d6441dd7c93f5b8a7d95f735c0daa3cc4dbb799f66d4</code></li>
</ul>
</li>
<li>mpress unpacked risepro<ul>
<li><code>16ae203879efe1912bb8b97ceb0f4645abcde27a987e98a171d59f9c1ec3f764</code></li>
</ul>
</li>
<li>privateloader<ul>
<li><code>1aa2d32ab883de5d4097a6d4fe7718a401f68ce95e0d2aea63212dd905103948</code></li>
</ul>
</li>
<li>rise pro<ul>
<li><code>2cd2f077ca597ad0ef234a357ea71558d5e039da9df9958d0b8bd0efa92e74c9</code></li>
</ul>
</li>
</ul>
<h2 id="Prior-Work">
<a class="anchor" href="#Prior-Work" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prior Work<a class="anchor-link" href="#Prior-Work"> </a>
</h2>
<p>There have been a few attempts at decrypting strings from malware that use this library (or a variation of the technique). While these are good references they don't cover all of the cases in a generic way which is our goal. There is also an IDA script that attempts to decrypt the library but we didn't have any success with it.</p>
<h3 id="X-Junior-IDA-Script">
<a class="anchor" href="#X-Junior-IDA-Script" aria-hidden="true"><span class="octicon octicon-link"></span></a>X-Junior IDA Script<a class="anchor-link" href="#X-Junior-IDA-Script"> </a>
</h3>
<p><a href="https://github.com/X-Junior">X-Junior</a> has a script that we can try in IDA to decrypt these strings: <a href="https://github.com/X-Junior/Malware-IDAPython-Scripts/tree/main/PivateLoader">GitHub Repo</a>.</p>
<h3 id="Andre-Tavares-Python-Script">
<a class="anchor" href="#Andre-Tavares-Python-Script" aria-hidden="true"><span class="octicon octicon-link"></span></a>Andre Tavares Python Script<a class="anchor-link" href="#Andre-Tavares-Python-Script"> </a>
</h3>
<p><a href="https://gist.github.com/andretavare5">andretavare5</a> has a python script using capstone to decrypt the strings: <a href="https://gist.github.com/andretavare5/66ec413cdb4c7c39d35c22d38c7067a8#file-privateloader_str_decrypt-py">Script Gist</a>. We have created our own hybrid of the two, which uses capstone for disassembly, but implements the logic from the IDA script.</p>
<h3 id="IDA-Xorstr-Decryption-Plugin">
<a class="anchor" href="#IDA-Xorstr-Decryption-Plugin" aria-hidden="true"><span class="octicon octicon-link"></span></a>IDA Xorstr Decryption Plugin<a class="anchor-link" href="#IDA-Xorstr-Decryption-Plugin"> </a>
</h3>
<p><a href="https://github.com/yubie-re/ida-jm-xorstr-decrypt-plugin">ida-jm-xorstr-decrypt-plugin</a>. This plugin was made to directly attack the xorstr library but it is x64 only and in testing we could not get it to work reliably.</p>
<h3 id="aimware_deobf_str">
<a class="anchor" href="#aimware_deobf_str" aria-hidden="true"><span class="octicon octicon-link"></span></a>aimware_deobf_str<a class="anchor-link" href="#aimware_deobf_str"> </a>
</h3>
<p><a href="https://github.com/unknowntrojan/aimware_deobf_str">aimware_deobf_str</a> is a similar approach using RUST! lol.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Regex-and-Dissassembly-Approach">
<a class="anchor" href="#Regex-and-Dissassembly-Approach" aria-hidden="true"><span class="octicon octicon-link"></span></a>Regex and Dissassembly Approach<a class="anchor-link" href="#Regex-and-Dissassembly-Approach"> </a>
</h2>
<p>Our first attempt at decryption uses a regex to identify the <code>pxor</code>/<code>pvxor</code> instructions then disassembles a small chunk of surrounding code which is then scanned for the stack string <code>mov</code> immediate pattern. We also use a recursive search for <code>mov</code> where there is an intermediate register or temporary memory location used to store the immediate before it is moved into place.</p>
<h3 id="Decryption-Algorithm">
<a class="anchor" href="#Decryption-Algorithm" aria-hidden="true"><span class="octicon octicon-link"></span></a>Decryption Algorithm<a class="anchor-link" href="#Decryption-Algorithm"> </a>
</h3>
<ul>
<li>select the first section in the PE file, assume this is the code</li>
<li>scan code for final <code>pxor</code> instruction and truncate at this instruction to remove extra code from scanning (handle packers with large first sections)</li>
<li>linear disassemble the prior 0x400 bytes of code - <strong>not efficient</strong>
</li>
<li>traverse assembly until <code>pxor</code> instruction is located</li>
<li>scan backwards until all immediate data is located for the <code>xmm</code> registers</li>
<li>decrypt xmm data, this is the string chunk</li>
</ul>
<h3 id="Limitations">
<a class="anchor" href="#Limitations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Limitations<a class="anchor-link" href="#Limitations"> </a>
</h3>
<ul>
<li>In some cases we end up re-dissassembling the same code again and again</li>
<li>The 0x400 bytes is an arbitrary number and might miss some of the string setup if there is a re-used chunk in a register (risepro)</li>
<li>The dissassembly can sometimes be misaligned </li>
<li>The DWORD chunks are sometimes moved into place out of order, without tracking displacement we cannot correct this</li>
</ul>
<h3 id="Possible-Improvements">
<a class="anchor" href="#Possible-Improvements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Possible Improvements<a class="anchor-link" href="#Possible-Improvements"> </a>
</h3>
<ul>
<li>Run full regex scan upfront and split binary into chunks based on the largest amount of code that covers all <code>pxor</code> instructions and only disassemble each once. </li>
<li>Use the <code>pxor</code> instruction offset to check for alignment when disassembling (still prone to errors... maybe try the x64dbg test for max valid instructions, could be slow)</li>
<li>Instead of just scanning for <code>mov</code> instructions to collect the DWORD chunks use a recursive scan to track the displacement for each <code>mov</code>
</li>
</ul>
<p><strong>TODO</strong></p>
<ul>
<li>We still need to implement the optimization of only dissassembling big chunks of code the contain the strings instead of re-disassembling the same chunks again and again</li>
<li>We need to implement EBP shift tracing </li>
<li>We need to check for other types of ESP shift and handle them</li>
<li>We need to expand the xor types to handle more than pxor</li>
<li>We need to expand the xor operands to handle more than just a register and an memory address </li>
<li>
<strong><strong>BUGS</strong></strong> Currently we are missing a few strings still for rise.bin (check the sql statements)</li>
<li>
<strong><strong>BUGS</strong></strong> Our string builder sometimes adds strings that are seperate look for a better solution (tighter address spacing maybe, or something in the code???)</li>
<li>
<strong><strong>BUGS</strong></strong> Doesn't work for priv.bin likely just need to handle more xor operands</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">unhex</span><span class="p">(</span><span class="n">hex_string</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">binascii</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">hex_string</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">hex_string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">hex_string</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">tohex</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">binascii</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pefile</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">from</span> <span class="nn">capstone</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">capstone.x86</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="n">log_level</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span>

<span class="c1"># Create logger</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>



<span class="c1"># Create console handler and set level to error</span>
<span class="n">ch</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
<span class="n">ch</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>

<span class="c1"># Create formatter</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">'</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">'</span><span class="p">)</span>

<span class="c1"># Add formatter to console handler</span>
<span class="n">ch</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>

<span class="c1"># Add console handler to logger</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>

<span class="c1"># Hack to clear handlers for jupyter notebook</span>
<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_ascii</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">128</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">string_builder</span><span class="p">(</span><span class="n">strings</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">last_addr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">last_string</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">last_addr</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="mi">98</span> <span class="ow">and</span> <span class="n">last_string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">last_string</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">last_string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">last_addr</span><span class="p">,</span><span class="n">last_string</span><span class="p">))</span>
            <span class="n">last_string</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">last_addr</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">last_addr</span><span class="p">,</span><span class="n">last_string</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">out</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)])</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">print_unique_strings</span><span class="p">(</span><span class="n">strings</span><span class="p">):</span>
    <span class="n">string_dict</span> <span class="o">=</span> <span class="p">{}</span>  
    <span class="n">last_string</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">last_string</span> <span class="o">!=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">string_dict</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">last_string</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found strings: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">string_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">string_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">o</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">string_dict</span><span class="p">[</span><span class="n">o</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_imm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">opr</span><span class="p">,</span> <span class="n">displacement</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"get_imm_data_recursive: </span><span class="si">{</span><span class="n">opr</span><span class="si">}</span><span class="s2">, displacement=</span><span class="si">{</span><span class="n">displacement</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="c1"># Sanity check</span>
    <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">X86_OP_REG</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"ERROR Operand type is not X86_OP_MEM or X86_OP_REG"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Determin the operand type</span>
    <span class="c1"># If the operand is a memory address search with displacement else search with register name</span>
    <span class="n">instruction_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ptr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">instruction_count</span><span class="p">):</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"recursive testing </span><span class="si">{</span><span class="n">inst</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2"> "</span><span class="p">)</span>

        <span class="c1"># If the opr memory we are searching for is ESP then we need to check for stack changes</span>
        <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'sub'</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reg</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ptr</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">instruction_count</span> <span class="ow">and</span> <span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'call'</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Assuming stack change is for call at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">X86_OP_IMM</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"ERROR: Expected immediate value for stack change"</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="n">displacement</span> <span class="o">-=</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">imm</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">: sub esp New displacement: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'add'</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reg</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">X86_OP_IMM</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"ERROR: Expected immediate value for stack change"</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">displacement</span> <span class="o">+=</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">imm</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">: add esp New displacement: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'push'</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">-=</span> <span class="mi">4</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">: push New displacement: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'pop'</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">+=</span> <span class="mi">4</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">: pop New displacement: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        
        <span class="c1"># Track the movs to see if they have the memory/register we are looking for</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'mov'</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span><span class="p">:</span>
                
                <span class="n">inst_op_mem</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span>
                <span class="k">if</span> <span class="n">inst_op_mem</span><span class="o">.</span><span class="n">disp</span> <span class="o">==</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">disp</span> <span class="o">+</span> <span class="n">displacement</span> <span class="ow">and</span> <span class="n">inst_op_mem</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span> <span class="ow">and</span> <span class="n">inst_op_mem</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">index</span> <span class="ow">and</span> <span class="n">inst_op_mem</span><span class="o">.</span><span class="n">scale</span> <span class="o">==</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">scale</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found mov mem for our mem at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_IMM</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">imm</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">get_imm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="p">:],</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reg</span> <span class="o">==</span> <span class="n">opr</span><span class="o">.</span><span class="n">reg</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found mov reg for our reg at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_IMM</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">imm</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">get_imm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="p">:],</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'lea'</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reg</span> <span class="o">==</span> <span class="n">opr</span><span class="o">.</span><span class="n">reg</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found lea reg for our reg at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">get_imm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="p">:],</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="kc">None</span>
            



<span class="k">def</span> <span class="nf">get_string_from_pxor_ex</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">xor_reg</span><span class="p">,</span> <span class="n">xor_mem</span><span class="p">):</span>
    <span class="c1"># Get the memory address moved into the xor_reg</span>
    <span class="n">xor_reg_mem</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">xor_reg_mem_offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ptr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">instructions</span><span class="p">)):</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Testing </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'mov'</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reg</span> <span class="o">==</span> <span class="n">xor_reg</span><span class="o">.</span><span class="n">reg</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">X86_OP_MEM</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error mov xor_reg is not a memory address at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">inst</span><span class="o">.</span><span class="n">op_str</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Get the memory address moved into the xor_mem</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found mov xor_reg at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">inst</span><span class="o">.</span><span class="n">op_str</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                <span class="n">xor_reg_mem</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">xor_reg_mem_offset</span> <span class="o">=</span> <span class="n">ptr</span>
                <span class="k">break</span>
    <span class="k">if</span> <span class="n">xor_reg_mem</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error mov xor_reg not found"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="c1"># Break xor_reg_mem memory base into 4 DWORD chunks</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Getting data chunks for xor_reg_mem"</span><span class="p">)</span>
    <span class="n">op_mem</span> <span class="o">=</span> <span class="n">xor_reg_mem</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span>
    <span class="n">op_disp</span> <span class="o">=</span> <span class="n">op_mem</span><span class="o">.</span><span class="n">disp</span>
    <span class="n">op_base</span> <span class="o">=</span> <span class="n">op_mem</span><span class="o">.</span><span class="n">base</span>
    <span class="n">op_index</span> <span class="o">=</span> <span class="n">op_mem</span><span class="o">.</span><span class="n">index</span>
    <span class="n">op_scale</span> <span class="o">=</span> <span class="n">op_mem</span><span class="o">.</span><span class="n">scale</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"op_disp:</span><span class="si">{</span><span class="n">op_disp</span><span class="si">}</span><span class="s2"> op_base:</span><span class="si">{</span><span class="n">op_base</span><span class="si">}</span><span class="s2"> op_index:</span><span class="si">{</span><span class="n">op_index</span><span class="si">}</span><span class="s2"> op_scale:</span><span class="si">{</span><span class="n">op_scale</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">data1</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">''</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
        <span class="n">tmp_chunk</span> <span class="o">=</span> <span class="n">get_imm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">[</span><span class="n">xor_reg_mem_offset</span><span class="p">:],</span> <span class="n">xor_reg_mem</span><span class="p">,</span> <span class="n">displacement</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tmp_chunk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error no imm found for xor_reg_mem </span><span class="si">{</span><span class="n">xor_reg_mem</span><span class="si">}</span><span class="s2"> at displacement </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"data1 chunk: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">tmp_chunk</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">data1</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;I'</span><span class="p">,</span> <span class="n">tmp_chunk</span><span class="p">)</span>   

    <span class="c1"># Recursive scan for each chunk and get the imm value</span>
    <span class="n">data2</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">''</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
        <span class="n">tmp_chunk</span> <span class="o">=</span> <span class="n">get_imm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">xor_mem</span><span class="p">,</span> <span class="n">displacement</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tmp_chunk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error no imm found for xor_mem </span><span class="si">{</span><span class="n">xor_mem</span><span class="si">}</span><span class="s2"> at displacement </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"data2 chunk: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">tmp_chunk</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">data2</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;I'</span><span class="p">,</span> <span class="n">tmp_chunk</span><span class="p">)</span>   
    
    <span class="n">out</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">,</span><span class="sa">b</span><span class="s1">''</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="c1">#print(out.decode('utf-8'))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_ascii</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_strings</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="c1"># Capstone setup</span>
    <span class="n">md</span> <span class="o">=</span> <span class="n">Cs</span><span class="p">(</span><span class="n">CS_ARCH_X86</span><span class="p">,</span> <span class="n">CS_MODE_32</span><span class="p">)</span> 
    <span class="n">md</span><span class="o">.</span><span class="n">detail</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">md</span><span class="o">.</span><span class="n">skipdata</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Get code from PE</span>
    <span class="n">pe</span> <span class="o">=</span> <span class="n">pefile</span><span class="o">.</span><span class="n">PE</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="c1"># Assume the first section is code</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">image_base</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">OPTIONAL_HEADER</span><span class="o">.</span><span class="n">ImageBase</span>
    <span class="n">section_rva</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">VirtualAddress</span>
    <span class="n">section_offset</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">PointerToRawData</span>
    <span class="n">section_data</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>


    <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="n">pxor_vpxor_vxorps_egg</span> <span class="o">=</span> <span class="sa">rb</span><span class="s1">'(\x66\x0F\xEF|\xC5\xFD\xEF|\xC5\xF8\x57)'</span>

    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pxor_vpxor_vxorps_egg</span><span class="p">,</span> <span class="n">section_data</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">):</span>
        <span class="n">xor_start</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> 

        <span class="c1"># Determine the instruction length</span>
        <span class="n">xor_instruction</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">disasm</span><span class="p">(</span><span class="n">section_data</span><span class="p">[</span><span class="n">xor_start</span><span class="p">:</span><span class="n">xor_start</span><span class="o">+</span><span class="mh">0x10</span><span class="p">],</span> <span class="n">image_base</span> <span class="o">+</span> <span class="n">section_rva</span> <span class="o">+</span> <span class="n">xor_start</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xor_instruction_address</span> <span class="o">=</span> <span class="n">image_base</span> <span class="o">+</span> <span class="n">section_rva</span> <span class="o">+</span> <span class="n">xor_start</span>

        <span class="c1"># if xor_instruction_address != 0x09910F2:</span>
        <span class="c1">#     continue</span>

        <span class="k">if</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">!=</span> <span class="s1">'pxor'</span> <span class="ow">and</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">!=</span> <span class="s1">'vpxor'</span> <span class="ow">and</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">!=</span> <span class="s1">'vxorps'</span><span class="p">:</span>
            <span class="c1">#print(f"Found {xor_instruction.mnemonic} instead of pxor")</span>
            <span class="k">continue</span>

        <span class="n">xor_len</span> <span class="o">=</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span> <span class="ow">and</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span><span class="p">:</span>
            <span class="c1"># Skip xor reg, reg</span>
            <span class="k">continue</span>
            
       
        <span class="k">if</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">X86_OP_REG</span> <span class="ow">or</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">X86_OP_MEM</span><span class="p">:</span>
            <span class="c1"># Skip anything that is not xor reg, [mem]</span>
            <span class="k">continue</span>
        
        <span class="n">scan_length</span> <span class="o">=</span> <span class="mh">0x2000</span>
        <span class="k">if</span> <span class="n">scan_length</span> <span class="o">&gt;</span> <span class="n">xor_start</span><span class="p">:</span>
            <span class="n">scan_length</span> <span class="o">=</span> <span class="n">xor_start</span>
        <span class="n">instructions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">md</span><span class="o">.</span><span class="n">disasm</span><span class="p">(</span><span class="n">section_data</span><span class="p">[</span><span class="n">xor_start</span><span class="o">-</span><span class="n">scan_length</span><span class="p">:</span><span class="n">xor_start</span><span class="p">],</span> <span class="n">xor_instruction_address</span> <span class="o">-</span> <span class="n">scan_length</span><span class="p">):</span>
            <span class="n">instructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"checking </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span><span class="si">}</span><span class="s2"> instructions"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'pxor'</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Testing pxor at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">xor_instruction_address</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">xor_instruction</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="n">tmp_string</span> <span class="o">=</span> <span class="n">get_string_from_pxor_ex</span><span class="p">(</span><span class="n">instructions</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1">#tmp_string = get_string_from_pxor_xmm(instructions[::-1], xor_instruction.operands[0], xor_instruction.operands[1])</span>
            <span class="k">if</span> <span class="n">tmp_string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">xor_instruction_address</span><span class="p">,</span><span class="n">tmp_string</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">strings</span>





<span class="n">filename</span> <span class="o">=</span> <span class="s1">'/tmp/xorstr/work/rise.bin'</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">strings</span> <span class="o">=</span> <span class="n">get_strings</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="c1"># Benchmark 50.47584390640259 metastealer    </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Benchmark </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>




<span class="n">ss</span><span class="o">=</span> <span class="n">string_builder</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Strings recovered: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">print_unique_strings</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
       

<span class="nb">print</span><span class="p">(</span><span class="s2">"done"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Benchmark 40.022075176239014
Strings recovered: 739
Found strings: 661

0x4010ec 0.1
0x4011ab 50500
0x4064ef RisePro
Telegram: https://t.me/RiseProSUPPORT
0x458e88 winhttp.dll
0x458f88 wininet.dll
0x459060 LocalSimbl
0x459123 LocalSimba
0x459463 grab_screen
0x4594d4 grab_tg
0x459542 grab_ds
0x4595b9 grab_wallets
0x459631 grab_ihistory
0x459717 logins
0x45977b Vault_IE
0x45982f logins
0x4598a4 WindowsCredentials
0x459adb .zip_
0x459bc0 .zip
0x459df4 \screenshot.png
0x459e97 \Files
0x459f2f \FileZilla
0x45a0eb \Plugins
0x45a30a \
0x45a526 IndexedDB
0x45a59c Sync
0x45a606 Local
0x45a66e \
0x45a823 \Wallets
0x45aa28 \
0x45ac41 IndexedDB
0x45acb7 Sync
0x45ad21 Local
0x45ad98 \
0x45afb0 \History
0x45b10f _
0x45b198 wb.txt
0x45b25f \
0x45b4ed url
0x45b5ea time
0x45b7bc \CC
0x45b944 _
0x45b9d6 wb.txt
0x45ba9d \
0x45be5d nickname
0x45bed6 name_on_card
0x45bfd0 card_number
0x45c0f5 last_four
0x45c246 **** **** **** 
0x45c393 billing_address_id
0x45c46c -
0x45c555 exp_month
0x45c5ce exp_year
0x45c766 expiration_month
0x45c8a0 expiration_year
0x45c931 -
0x45ca9c Name: %s
Nickna
0x45cb35 me: %s
Month: %s
Year: %s
Card: %s
Address: %s


0x45cdcb \Autofill
0x45cf2e _
0x45cfba wb.txt\
0x45d2e7 name
0x45d364 value
0x45d483 %s	%s

0x45d5b1 \Downloads
0x45d702 _
0x45d78b wb.txt
0x45d852 \
0x45dae2 url
0x45dbbb path
0x45ddaf \Cookies
0x45df06 _
0x45df8f ab.txt
0x45e056 \
0x45e36a domain
0x45e3e3 path
0x45e4db expirationDate
0x45e5eb L!
0x45e666 name
0x45e6df value
0x45e7d6 secure
0x45e858 TRUEFALSE
0x45e924 httpOnly
0x45e9a3 TRUE
0x45ea0d FALSE
0x45eb22 %s	%s	%s	%s	%llu	%s	%s

0x45ed83 _
0x45ee06 ab.txt
0x45eeca \
0x45f157 domain
0x45f2d2 path
0x45f3d4 expirationDate
0x45f465 name
0x45f559 value
0x45f6c9 TRUE
0x45f73c FALSE
0x45f7aa httpOnly
0x45f829 TRUEFALSE
0x45f986 %s	%s	%s	%s	%llu	%s	%s

0x45fb81 wb\passwords.txt
0x45fe51 url
0x45fece login
0x45ffce password
0x4600bf profile
0x4602b4 
Storage: %s [%s]
URL: %s
Login: %s
Password: %s


0x46058c file
0x4605f7 url
0x4606f1 login
0x4607f1 password
0x4608f1 profile
0x460a7e 
Storage: %s [%s]
URL: %s
Login: %s
Password: %s


0x460c3d wb\discord.txt
0x460dfa 
Storage: %s
UserName: %s
E-MAIL: %s
Token: %s


0x460f6c nss3.dll
0x46225b bhghoamapcdpbohphigoooaddinpkbai
0x462449 nkbihfbeogaeaoehlefnkodbefgpgknn
0x462691 cjelfplplebdjjenllpjcblmjkfcffne
0x46287f kncchdigobghenbbaddojjnnaogfppfj
0x462a82 fihkakfobkmkjojpchpfgcmhfjnmnfpi
0x462c83 nkddgncdjgjfcddamfgcmfnlhccnimig
0x462edb nanjmdknhkinifnkgdcggcfnhdaammmj
0x46307f nlbmnnijcnlegkjjpcfjclmcfggfefdm
0x46328e amkmjjmmflddogmhpjloimipbofnfjih
0x463491 nhnkbkgjikgcigadomkphalanndcapjk
0x463697 cphhlgmgameodnhkjdmkpanlelnlohao
0x46389a fnjhmkhhmkbjkkabndcnnogagogbneec
0x463a9d kpfopkelmapcoipemfendmdcghnegimn
0x463ca0 blnieiiffboillknjnepogjhkgnoapac
0x463ea1 hpglfhgfnhbgpjdenjgmdgoeiappafln
0x4640f9 hnfanknocfeofbddgcijnmhnfnkdnaad
0x46429d jbdaocneiiinmjbjlgalhcelgbejmnid
0x4646af ffnbelfdoeiohenkjibnmadjiehjhajb
0x4648fa fhbohimaelbohpjbbldcngcnapndodjp
0x464afd ibnejdfjmmkpcnlpebklmnkoeoihofec
0x464d00 bfnaelmomeimhlpmgjnjophhpkkoljpa
0x464edf fhilaheimglignddkjgofkcbgekhenbh
0x4650f7 mgffkfbidihjpoaomajlbgchddlicgpn
0x46531e aodkkagnadcbobfpggfnjeongemjbjca
0x465545 fmblappgoiilbgafhjklehhfifbdocee
0x46576c hmeobnfnfcmdkdcmlblgagmfpfboieaf
0x4659d8 dngmlblcodfobpdpecaadgfbcggfjfnm
0x465bff pdadjkfkgcafgbceimcpbkalnfnepbnk
0x465e26 aeachknmefphepccionboohckonoeemg
0x46604d aiifbnbfobpmeekipheeijimdpnlpgpp
0x466270 fnnegphlobjdpkhecapkijjdkgcjhkib
0x466497 lpfcbjknijpeeillifnkikgncikgfhdo
0x4666be aholpfdialjgjfhomihkjbmgjidlcdno
0x4668e5 afbcbjpbpfadlkmhmclhkeeodmamcflc
0x466b0c dmkamcknogkgcdfhhbddcghachkejeap
0x466d33 fhmfendgdocmcbmfikdcogofphimnkno
0x466f5a cnmamaachppnkjgnildpdmkaakejnhae
0x467181 jojhfeoedkpkglbfimdfabpdfjaoolaf
0x4673a8 flpiciilemghbmfalicajoolhkkenfel
0x4675cf cgeeodpfagjceefieflmdfphplkenlfk
0x4677f6 acmacodkjbdgmoleebolmdjonilkdbch
0x467a1d odbfpeeihdkbihmopkbjmoonfanlbfcl
0x467c44 lpilbniiabackdjcionkobglmddfbcjo
0x467e6b bhhhlbepdkbapadjdnnojkbgioiodbic
0x468092 dkdedlpgdmmkkfjabffeganieamfklkm
0x4682b9 hcflpincpppdclinealmandijcmnkbgn
0x4684e0 mnfifefkajgofkcjkemidiaecocnkjeh
0x468707 ookjlbkiijinhpmnjffcofjonbfbgaoc
0x468929 jnkelfanjkeadonecabehalmbgpfodjm
0x468b4e jnlgamecbpmbajjfhmmmlhejkemejdma
0x468e13 kkpllkodjeloidieedojogacfhpaihoh
0x469032 mcohilncbfahbmgdjkbpemcciiolgcge
0x469243 epapihdplajcdnnkdeiahlgigofloibg
0x469454 gjagmgiddbbciopjhllkdnddhcglnemk
0x469665 kmhcihpebfmpgmihbkipmjlmmioameka
0x469883 bgpipimickeadkjlklgciifhnalhdjhe
0x469af4 phkbamefinggmakgklpkljjmgibohnba
0x469d60 ejjladinnckdgjemekebdpeokbikhfci
0x469f87 gojhcdgcpbpfigcaejpfhfegekdgiblk
0x46a1f3 efbglgofoippbgcjepnhiblaibcnclgk
0x46a416 cjmkndjhnagcfbpiemnkdpomccnjblmj
0x46a682 aijcbedoijmgnlmjeegjaglmepbmpkpi
0x46a8a9 egjidjbpglichdcondbcbdnbeeppgdph
0x46ab15 oeljdldpnmdbchonielidgobddffflal
0x46ad7c ilgcnhelpchnceeipipijaljkblbcobl
0x46afe3 imloifkgjagghnnc
0x46b05b jkhggdhalmcnfklk
0x46b44e Local StateLogin Data
0x46bbe9 cookies
0x46bc81 Local StateCookies
0x46bf4f Login Data
0x46c133 \Mozilla\FirefoxFirefox\WaterfoxWaterfox
0x46c3c3 \Comodo\IceDragonIceDragon
0x46c4c9 berfox
0x46c5aa ogies\BlackHaw
0x46c679 \Moonchild Productions\Pale MoonPale Moon
0x46c785 \DiscordDiscord
0x46c81a \discordcanaryDiscordCanary\discordptbDiscordPTB
0x46c959 \discorddevelopmentDiscordDevelopment
0x46ca56 \Opera SoftwareOpera
0x46caf4 \Google\Chrome\User DataChrome
0x46cbd5 \Microsoft\Edge\User DataEdge
0x46cced \BraveSoftware\Brave-Browser\User DataBrave
0x46cde7 \CryptoTab Browser\User DataCryptoTab\Battle.netBattle.net
0x46cf71 \Chromium\User DataChromium
0x46d048 \Google(x86)\Chrome\User DataChrome (x86)
0x46d135 \Yandex\YandexBrowser\User DataYandex
0x46d21f \NVIDIA Corporation\NVIDIA GeForce ExperienceNVIDIA\SteamSteam
0x46d3ef \Amigo\User\User DataAmigo
0x46d4df \Iridium\User DataIridium
0x46d5c4 \MapleStudio\ChromePlus\User DataChromePlus
0x46d6f0 \7Star\7Star\User Data7Star
0x46d7dc \CentBrowser\User DataCentBrowser
0x46d8b5 \Chedot\User DataChedot
0x46d98b \Vivaldi\User DataVivaldi
0x46da73 \Kometa\User DataKometa
0x46db5a \Elements Browse
0x46dbc4 Elements Browser
0x46dc63 \Epic Privacy Br
0x46dcf8 Epic Privacy Bro
0x46dd87 \uCozMedia\Uran\User DatauCozMedia
0x46dea9 \Fenrir Inc\Sleipnir5\setting\modules\ChromiumViewerChromiumViewer
0x46e038 \CatalinaGroup\Citrio\User DataCitrio
0x46e0f3 \Coowon\Coowon\User DataCoowon
0x46e1dd \liebao\User Datliebao
0x46e2a4 \QIP Surf\User DtaQIP Surf
0x46e384 \Orbitum\User DaaOrbitum
0x46e47b \Comodo\Dragon\User DataDragon
0x46e544 \Torch\User Data
0x46e5af Torch
0x46e625 \Comodo\User DataComodo
0x46e71b \360Browser\Browser\User Data360Browser
0x46e7e3 \Maxthon3\User DataMaxthon3
0x46e8c2 \K-Melon\User DataK-Melon
0x46e994 \Sputnik\Sputnik\User DataSputnik
0x46ea87 \Nichrome\User DataNichrome
0x46eb78 \CocCoc\Browser\User DataCocCoc
0x46ec3a \Uran\User DataUran
0x46ecfd \Chromodo\User DataChromodo
0x46edb3 \Mail.Ru\Atom\User DataAtom
0x46ee8c \NetboxBrowser\User DataNetboxBrowser
0x46f0f1 rule_exceptionsrule_filesrule_folderrule_size_kb
0x46f262 rule_collect_recursv
0x46f301 :
0x46f386 , 
0x46f412 %DESKTOP%
0x46f548 %DOCUMENTS%
0x46f683 %USERPROFILE%
0x46f7be %APPDATA%
0x46f8f9 %LOCALAPPDATA%
0x46fa31 %RECENT%
0x46fbea (.-)*
0x46fca1 (.-)
0x46fd44 (.*)(.-)(.-)
0x470047 /
0x4707ca ld_name
0x470890 ld_geo
0x470a69  
0x470b12 ,
0x470d36 mark_check_cookies
0x470e08 mark_check_passwords
0x470eda mark_check_history
0x470fb6 mark_domains
0x471037 ,
0x471217 domain
0x47133e .
0x4715cc domain
0x4716f3 .
0x4718e4 url
0x472087 .exe
0x4720fc .
0x4721c8 exe
0x472259 msi
0x4722ea scr
0x47237b txt
0x47240c doc
0x47249d docx
0x47252e png
0x4725c2 jpg
0x472656 jpeg
0x4726ea bmp
0x47277e bat
0x472818 vbs
0x472a10 exe
0x472a99 .
0x472b1c \
0x472c1a https://
0x472d06 open
0x472ee5 \Telegram Desktop
0x473004 \tdata
0x473074 rb\key_datas
0x473165 \*.*
0x473204 rb\maps\
0x473450 \Telegram
0x4734dd \tdata
0x473572 \key_datas
0x473773 \
0x473833 \maps
0x473896 \\maps
0x473b1d s
0x473b84 \
0x473d73 logins
0x473eb6 profile
0x473f69 url
0x47400a login
0x47408b password
0x47410b logins
0x4743fc profile
0x474490 url
0x474548 login
0x474601 password
0x4746b9 logins
0x47482c profile
0x4748c1 url
0x474978 login
0x474a31 password
0x474ad7 logins
0x474bef vaultcli.dll
0x474c68 VaultEnumerateItems
0x474cfd VaultEnumerateVaultsVaultFreeVaultOpenVaultVaultCloseVaultVaultGetItemVaultGetItem
0x474f9e history
0x47504d \profiles.ini
0x4750f2 Profile
0x47519d Path
0x475208 \
0x4752ea /
0x4753c2 \
0x4754a3 \places.sqlite
0x47552b rb
0x47577a SELECT place_id, visit_date FROM
0x475904 (SELECT place_id, visit_date, id FROM moz_historyvisits ORDER BY id DESC LIMIT 2500) ORDER BY id ASC
0x475a59 )
0x475ae0 SELECT url FROM 
0x475b51 moz_places WHERE
0x475bc1  (`id` = 
0x475e9f history
0x475fb9 cookies
0x476068 \profiles.ini
0x47611f Profile
0x4761e2 Path
0x476267 \
0x476340 /
0x476426 \
0x476509 \cookies.sqlite
0x476596 rb
0x476741 SELECT host, isHttpOnly, path, isSecure, expiry, name, value FROM moz_cookies
0x476b0b httpOnly
0x476c9e secure
0x476e0e value
0x476ed0 cookies
0x476ffb download_history
0x4770ea \profiles.ini
0x4771b6 Profile
0x477276 Path
0x4772f6 \
0x4773db /
0x4774c1 \
0x47759d \places.sqlite
0x477625 rb
0x4777b8 SELECT place_id, content FROM moz_annos WHERE (`anno_attribute_id` = 1)
0x477980 )
0x4779f5 SELECT url FROM 
0x477a63 moz_places WHERE
0x477ad3  (`id` = 
0x477cbd file:///
0x477edb download_history
0x47802e autofill
0x4780f1 \profiles.ini
0x4781a4 Profile
0x478267 Path
0x4782e9 \
0x4783d1 /
0x4784ba \
0x47857c \formhistory.sqlite
0x47865f rb
0x478785 SELECT fieldname, value FROM moz_formhistory
0x478a69 autofill
0x478b7c logins
0x478c25 \profiles.ini
0x478cd4 Profile
0x478d8f Path
0x478e0f \
0x478ed7 \logins.json
0x478f5f rb
0x478ff2 \signons.sqlite
0x479146 SELECT encryptedUsername, encryptedPassword, formSubmitURL FROM moz_logins
0x4794cc login
0x479959 formSubmitURL
0x479bd6 logins
0x479e48 NSS_InitNSS_Shutdown
0x479f01 PK11_GetInternalKeySlotPK11_FreeSlot
0x479fe3 PK11_AuthenticatePK11SDR_Decrypt
0x47a281 \
0x47a433 \Local State
0x47a4d6 os_cryptos_cryptencrypted_keyos_cryptencrypted_key
0x47a7a9 \Local State\
0x47a932 os_crypt
0x47aa2c encrypted_key
0x47aaae os_crypt
0x47ab28 encrypted_key
0x47ac21 \
0x47ae67 .log
0x47af0c .ldb
0x47b24e dQw4w9WgXcQ:[^.*\['(.*)'\].*$][^"]*
0x47b3fa dQw4w9WgXcQ:
0x47b6f6 discord.com/api/v9/users/@me
0x47b815 usernameemailusername
0x47b930 email
0x47be84 \CURRENT\Sync Extension Settings\\
0x47bfed \CURRENT\Local Extension Settings\\
0x47c163 _0.indexeddb.leveldb\CURRENT\IndexedDB\chrome-extension_\
0x47c62a Settings\\Sync Extension \
0x47c789  Settings\\Local Extension\
0x47c8f5 e-extension_\IndexedDB\chromeldb\_0.indexeddb.lev
0x47cad5 \CURRENT
0x47cd9d history
0x47cef7 \
0x47d3f0 SELECT url, last_visit_time FROM(SELECT url, last_visit_time, id FROM urls ORDER
0x47d5a4  BY id DESC LIMIT 2500) ORDER BY id ASC
0x47d942 cookies
0x47dacd \Network\
0x47dd3f \
0x47de18 os_cryptos_cryptencrypted_keyos_cryptencrypted_key
0x47e0da \\
0x47e29d os_crypt
0x47e397 encrypted_key
0x47e419 os_crypt
0x47e493 encrypted_key
0x47e5d2 Network\
0x47e900 SELECT host_key, is_httponly, path, is_secure, expires_utc, name, value, encrypted_value FROM cookies
0x47ed54 httpOnly
0x47eed2 secure
0x47f0f6 v10
0x47f175 v11
0x47f23e value
0x47f529 cards
0x47f682 \
0x47f92a os_cryptos_cryptencrypted_keyos_cryptencrypted_key
0x47fbfb \
0x47fdc4 os_crypt
0x47febe encrypted_key
0x47ff40 os_crypt
0x47ffba encrypted_key
0x4803bc SELECT name_on_card, expiration_
0x480546 month, expiration_year, card_number_encrypted, origin, billing_address_id, nickname FROM credit_cards
0x4809f6 v10
0x480a72 v11
0x480c18 billing_address_
0x480f38 SELECT name_on_card, exp_month, 
0x4810be exp_year, last_four, nickname, bank_name, card_art_url, status, network FROM masked_credit_cards
0x4814ab last_four
0x4816b7 status
0x481975 download_history
0x481b13 \
0x481f6f SELECT tab_url, target_path FROM downloads
0x482359 autofill
0x4824b3 \
0x4828d1 SELECT name, value FROM autofill
0x482cba logins
0x482dfa \
0x483080 os_cryptos_cryptencrypted_keyos_cryptencrypted_key
0x483322 \\
0x4834e2 os_crypt
0x4835dc encrypted_key
0x48365e os_crypt
0x4836d8 encrypted_key
0x4839f8 SELECT action_url, origin_url, username_value, password_value FROM logins
0x483cdf v10
0x483d59 v11
0x483e0a profile
0x48414b \*
0x48422a \
0x484369 v10v11
0x484825 90
0x48489b 3
0x484ac9 freebl3.dllmozglue.dllnss3.dllsoftokn3.dllmsvcp140.dll
0x484cae vcruntime140.dll
0x484d88 \
0x48541e wb
0x48565d An uncaught exception occurred3: 
0x485869 An uncaught exception occurred3. The type was unknown so no information was available.
0x485da0 api.myip.com
0x485e6b ip
0x485f57 cc
0x4860d3 An uncaught exception occurred_ip0_1: 
0x486300 An uncaught exception occurred_ip0_1. The type was unknown so no information was available.
0x486460 api64.ipify.org/?format=json
0x486542 ip
0x4866d6 An uncaught exception occurred_ip0_2: 
0x486907 An uncaught exception occurred_ip0_2. The type was unknown so no information was available.
0x486a7d ipinfo.io/widget/demo/
0x486b5c data
0x486c2c country
0x486c96 data
0x486cfb country
0x486d7b data
0x486ddf city
0x486e47 data
0x486eab city
0x486fb6 An uncaught exception occurred_ip1: 
0x4871e3 An uncaught exception occurred_ip1. The type was unknown so no information was available.
0x487351 db-ip.com/demo/home.php?s=
0x487430 demoInfo
0x487507 countryCode
0x487574 demoInfo
0x4875dd countryCode
0x487660 demoInfo
0x4876c4 city
0x48772f demoInfo
0x487793 city
0x48789f An uncaught exception occurred_ip2: 
0x487acc An uncaught exception occurred_ip2. The type was unknown so no information was available.
0x487c81 www.maxmind.com/geoip/v2.1/city/me
0x487d6c country
0x487ead iso_code
0x487f1a country
0x487f7f iso_code
0x487fe9 city
0x48804e names
0x4880b1 en
0x48811c country
0x488181 iso_code
0x488207 city
0x48826c names
0x4882cf en
0x488405 An uncaught exception occurred_ip4: 
0x48863e An uncaught exception occurred_ip4. The type was unknown so no information was available.
0x48874a 1.1.1.1
0x4887b4 ZZ
0x488828 Unknown
0x488af8 \
0x488d05 msvcp140.dll
0x488d90 vcruntime140.dll
0x488e27 freebl3.dll
0x488e95 mozglue.dll
0x488f00 nss3.dll
0x488f6a softokn3.dll
0x489009 DLL\
0x489209 ://
0x489343 mark_name
0x4894c4 \atomic\Local Storage
0x48955b \Atomic
0x489698 \Electrum\wallets
0x489731 \Electrum
0x48985a \Exodus\exodus.wallet
0x4898f0 \Exodus
0x489a19 \Electrum-LTC\wallets
0x489ab2 \ElectrumLTC
0x489b97 \Monero\wallets
0x489c1d \Monero
0x489d43 \com.liberty.jaxx
0x489ddf \Jaxx Liberty
0x489e62 \IndexedDB
0x48a000 \Local Storage
0x48a1d3 \Session Storage
0x48a442 \Jaxx\Local Storage
0x48a4d5 \Jaxx
0x48a5f8 \Coinomi\Coinomi\wallets
0x48a68b \Coinomi
0x48a764 \Armory
0x48a90d \WalletWasabi\Client\Wallets
0x48a9a0 \Wasabi
0x48aac1 \Bither\bither.db
0x48ab56 \Bither
0x48abce \bither.db
0x48acd6 \ElectronCash\wallets
0x48ad6b \ElectronCash
0x48ae90 \Binance\app-store.json
0x48af25 \Binance
0x48afa1 \app-store.json
0x48b0a6 \Ethereum\wallets
0x48b137 \Ethereum
0x48b211 \Guarda
0x48b310 \IndexedDB
0x48b4a6 \Local Storage
0x48b673 \Session Storage
0x48b8df \MultiDoge\multidoge.wallet
0x48b97a \MultiDoge
0x48ba31 \multidoge.wallet
0x48bb0e Bitcoin
0x48bb77 DogecoinAnoncoin
0x48bc38 BBQCoinBBQCoinDashCoreFlorincoinFrankoFreicoin
0x48be71 GoldCoin (GLD)
0x48bed4 IOCoin
0x48bf39 InfinitecoinIxcoin
0x48bffd MegacoinMincoinNamecoin
0x48c123 PrimecoinTerracoinYACoinZcashdevcoindigitalcoin
0x48c35e LitecoinReddcoin
0x48c449 Daedalus Mainnet
0x48c4cb Ledger Live
0x48c629 \
0x48c6f1 \wallet.dat\
0x48c7f8 \wallet.dat\wallet.dat
0x48c90a \wallets
0x48c97a \
0x48ca1c \wallets
0x48cbb7 \Authy Desktop
0x48cc64 \Authy
0x48ccf7 \IndexedDB
0x48ce9a \Local Storage
0x48d056 \Session Storage
0x48d328 \*.*
0x48d689 \information.txt
0x48d734 wb
0x48d7c3 Version: %s


0x48d837 Date: %sUnknown
0x48d90d SOFTWARE\Microsoft\Cryptography
0x48d9cf MachineGuid
0x48da64 MachineID: %s
Unknown
0x48db55 GUID: %s
___
0x48ddcb HWID: %s

0x48de4a 
Path: %s
Work Dir: %s

IP: %s

0x48dfac Location: %s, %s

0x48e090 SOFTWARE\Microsoft\Windows NT\CurrentVersion
0x48e17b ProductNamex64x32
0x48e26b Windows: %s [%s]

0x48e36c Computer Name: %s

0x48e41f User Name: %s

0x48e4b2 Display Resolution: %dx%d

0x48e5aa Display Language: %ws
Display Language: Unknown

0x48e68a Keyboard Languages: 
0x48e78e  / %s
0x48e879 
Local Time: %d/%d/%d %d:%d:%d

0x48e9c8 TimeZone: UTC%d

0x48ea2e 
[Hardware]

0x48eac0 HARDWARE\DESCRIPTION\System\CentralProcessor\0
0x48ebf5 ProcessorNameStringProcessor: %s

0x48ecf9 CPU Count: %d

0x48ed73 RAM: %u MB

0x48eed7 VideoCard #%d: %s

0x48efd1 
[Processes]

0x48f074 %s [%d]

0x48f0dd 
[Software]

0x48f198 SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall
0x48f309 %s\%s
0x48f3cd DisplayName
0x48f462 DisplayVersion
0x48f4cf %s [%s]

0x48f5b9 wb
0x48f835 %X
0x49000f rb
0x490153 RtlGetVersionNtdll.dll
0x490244 rb
0x490d15 http:///
0x490dfa ?
0x49128d .
0x4912f3 .dll
0x49135f #
0x491491 WINHTTP.dllWinHttpConnect
0x49154f WinHttpQueryHeadersWinHttpOpen
0x49162a WinHttpOpenRequest
0x4916bd WinHttpQueryDataAvailable
0x49174c WinHttpSendRequest
0x4917df WinHttpReceiveResponseWinHttpReadData
0x4918c2 WinHttpCloseHandle
0x49194e WinHttpSetTimeouts
0x491d1e wb
0x491e39 HEAD
0x4920ed InternetOpenA
0x492159 InternetSetOptionA
0x4921e6 HttpOpenRequestA
0x492273 InternetConnectA
0x492300 InternetOpenUrlA
0x492372 HttpQueryInfoA
0x4923de InternetQueryOptionA
0x49246b HttpSendRequestA
0x4924f8 InternetReadFile
0x492585 InternetCloseHandle
done
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Speed-Optimizations">
<a class="anchor" href="#Speed-Optimizations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Speed Optimizations<a class="anchor-link" href="#Speed-Optimizations"> </a>
</h3>
<p>Instead of iterativly scanning with a regex and disassembling for each <code>pxor</code> instruction we can perform one full scan and then split the binary into chunks that contain all the <code>pxor</code> instructions. These chunks can then be disassembled a single time and the results re-used for each <code>pxor</code> hit.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_strings_fast</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="c1"># Capstone setup</span>
    <span class="n">md</span> <span class="o">=</span> <span class="n">Cs</span><span class="p">(</span><span class="n">CS_ARCH_X86</span><span class="p">,</span> <span class="n">CS_MODE_32</span><span class="p">)</span> 
    <span class="n">md</span><span class="o">.</span><span class="n">detail</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">md</span><span class="o">.</span><span class="n">skipdata</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Get code from PE</span>
    <span class="n">pe</span> <span class="o">=</span> <span class="n">pefile</span><span class="o">.</span><span class="n">PE</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="c1"># Assume the first section is code</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">image_base</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">OPTIONAL_HEADER</span><span class="o">.</span><span class="n">ImageBase</span>
    <span class="n">section_rva</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">VirtualAddress</span>
    <span class="n">section_offset</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">PointerToRawData</span>
    <span class="n">section_data</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>


    <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
        
    <span class="n">pxor_vpxor_vxorps_egg</span> <span class="o">=</span> <span class="sa">rb</span><span class="s1">'(\x66\x0F\xEF|\xC5\xFD\xEF|\xC5\xF8\x57)'</span>

    <span class="n">chunk_offsets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">last_end</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">pxor_vpxor_vxorps_egg</span><span class="p">,</span> <span class="n">section_data</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">):</span>
        <span class="n">xor_start</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> 

        <span class="c1"># Determine the instruction length</span>
        <span class="n">xor_instruction</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">disasm</span><span class="p">(</span><span class="n">section_data</span><span class="p">[</span><span class="n">xor_start</span><span class="p">:</span><span class="n">xor_start</span><span class="o">+</span><span class="mh">0x10</span><span class="p">],</span> <span class="n">image_base</span> <span class="o">+</span> <span class="n">section_rva</span> <span class="o">+</span> <span class="n">xor_start</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xor_instruction_address</span> <span class="o">=</span> <span class="n">image_base</span> <span class="o">+</span> <span class="n">section_rva</span> <span class="o">+</span> <span class="n">xor_start</span>

        <span class="k">if</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'pxor'</span> <span class="ow">and</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span> <span class="ow">and</span> <span class="n">xor_instruction</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span><span class="p">:</span>
            <span class="n">scan_length</span> <span class="o">=</span> <span class="mh">0x2000</span>
            <span class="k">if</span> <span class="n">scan_length</span> <span class="o">&gt;</span> <span class="n">xor_start</span><span class="p">:</span>
                <span class="n">scan_length</span> <span class="o">=</span> <span class="n">xor_start</span>
            <span class="k">if</span> <span class="n">xor_start</span> <span class="o">-</span> <span class="n">scan_length</span> <span class="o">&lt;</span> <span class="n">last_end</span><span class="p">:</span>
                <span class="c1"># Update last chunk with new end</span>
                <span class="n">chunk_offsets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">chunk_offsets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">xor_start</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">chunk_offsets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">xor_start</span> <span class="o">-</span> <span class="n">scan_length</span><span class="p">,</span> <span class="n">xor_start</span> <span class="o">+</span> <span class="mi">10</span><span class="p">))</span>

            <span class="n">last_end</span> <span class="o">=</span> <span class="n">xor_start</span> <span class="o">+</span> <span class="mi">10</span>

    <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">chunk_offset</span> <span class="ow">in</span> <span class="n">chunk_offsets</span><span class="p">:</span>
        <span class="n">chunk_data</span> <span class="o">=</span> <span class="n">section_data</span><span class="p">[</span><span class="n">chunk_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">chunk_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">chunk_instruction_address</span> <span class="o">=</span> <span class="n">image_base</span> <span class="o">+</span> <span class="n">section_rva</span> <span class="o">+</span> <span class="n">chunk_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">instructions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">inst</span> <span class="ow">in</span> <span class="n">md</span><span class="o">.</span><span class="n">disasm</span><span class="p">(</span><span class="n">chunk_data</span><span class="p">,</span> <span class="n">chunk_instruction_address</span><span class="p">):</span>
            <span class="n">instructions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span>
        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>


    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
        <span class="n">chunk_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chunk_len</span><span class="p">):</span>
            <span class="n">inst</span> <span class="o">=</span> <span class="n">chunk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'pxor'</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span><span class="p">:</span>
                <span class="n">tmp_string</span> <span class="o">=</span> <span class="n">get_string_from_pxor_ex</span><span class="p">(</span><span class="n">chunk</span><span class="p">[</span><span class="n">i</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mh">0x2000</span><span class="p">],</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">tmp_string</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">,</span><span class="n">tmp_string</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">strings</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s1">'/tmp/xorstr/work/rise.bin'</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">strings</span> <span class="o">=</span> <span class="n">get_strings_fast</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="c1"># Benchmark 50.47584390640259 metastealer    </span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Benchmark </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>




<span class="n">ss</span><span class="o">=</span> <span class="n">string_builder</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Strings recovered: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">print_unique_strings</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
       

<span class="nb">print</span><span class="p">(</span><span class="s2">"done"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Benchmark 15.065591096878052
Strings recovered: 743
Found strings: 665

0x4010ec 0.1
0x4011ab 50500
0x4064ef RisePro
Telegram: https://t.me/RiseProSUPPORT
0x458e88 winhttp.dll
0x458f88 wininet.dll
0x459060 LocalSimbl
0x459123 LocalSimba
0x459463 grab_screen
0x4594d4 grab_tg
0x459542 grab_ds
0x4595b9 grab_wallets
0x459631 grab_ihistory
0x459717 logins
0x45977b Vault_IE
0x45982f logins
0x4598a4 WindowsCredentials
0x459adb .zip_
0x459bc0 .zip
0x459df4 \screenshot.png
0x459e97 \Files
0x459f2f \FileZilla
0x45a0eb \Plugins
0x45a30a \
0x45a526 IndexedDB
0x45a59c Sync
0x45a606 Local
0x45a66e \
0x45a823 \Wallets
0x45aa28 \
0x45ac41 IndexedDB
0x45acb7 Sync
0x45ad21 Local
0x45ad98 \
0x45afb0 \History
0x45b10f _
0x45b198 wb.txt
0x45b25f \
0x45b4ed url
0x45b5ea time
0x45b7bc \CC
0x45b944 _
0x45b9d6 wb.txt
0x45ba9d \
0x45be5d nickname
0x45bed6 name_on_card
0x45bfd0 card_number
0x45c0f5 last_four
0x45c246 **** **** **** 
0x45c393 billing_address_id
0x45c46c -
0x45c555 exp_month
0x45c5ce exp_year
0x45c766 expiration_month
0x45c8a0 expiration_year
0x45c931 -
0x45ca9c Name: %s
Nickna
0x45cb35 me: %s
Month: %s
Year: %s
Card: %s
Address: %s


0x45cdcb \Autofill
0x45cf2e _
0x45cfba wb.txt\
0x45d2e7 name
0x45d364 value
0x45d483 %s	%s

0x45d5b1 \Downloads
0x45d702 _
0x45d78b wb.txt
0x45d852 \
0x45dae2 url
0x45dbbb path
0x45ddaf \Cookies
0x45df06 _
0x45df8f ab.txt
0x45e056 \
0x45e36a domain
0x45e3e3 path
0x45e4db expirationDate
0x45e5eb L!
0x45e666 name
0x45e6df value
0x45e7d6 secure
0x45e858 TRUEFALSE
0x45e924 httpOnly
0x45e9a3 TRUE
0x45ea0d FALSE
0x45eb22 %s	%s	%s	%s	%llu	%s	%s

0x45ed83 _
0x45ee06 ab.txt
0x45eeca \
0x45f157 domain
0x45f2d2 path
0x45f3d4 expirationDate
0x45f465 name
0x45f559 value
0x45f6c9 TRUE
0x45f73c FALSE
0x45f7aa httpOnly
0x45f829 TRUEFALSE
0x45f986 %s	%s	%s	%s	%llu	%s	%s

0x45fb81 wb\passwords.txt
0x45fe51 url
0x45fece login
0x45ffce password
0x4600bf profile
0x4602b4 
Storage: %s [%s]
URL: %s
Login: %s
Password: %s


0x46058c file
0x4605f7 url
0x4606f1 login
0x4607f1 password
0x4608f1 profile
0x460a7e 
Storage: %s [%s]
URL: %s
Login: %s
Password: %s


0x460c3d wb\discord.txt
0x460dfa 
Storage: %s
UserName: %s
E-MAIL: %s
Token: %s


0x460f6c nss3.dll
0x46225b bhghoamapcdpbohphigoooaddinpkbai
0x462449 nkbihfbeogaeaoehlefnkodbefgpgknn
0x462691 cjelfplplebdjjenllpjcblmjkfcffne
0x46287f kncchdigobghenbbaddojjnnaogfppfj
0x462a82 fihkakfobkmkjojpchpfgcmhfjnmnfpi
0x462c83 nkddgncdjgjfcddamfgcmfnlhccnimig
0x462edb nanjmdknhkinifnkgdcggcfnhdaammmj
0x46307f nlbmnnijcnlegkjjpcfjclmcfggfefdm
0x46328e amkmjjmmflddogmhpjloimipbofnfjih
0x463491 nhnkbkgjikgcigadomkphalanndcapjk
0x463697 cphhlgmgameodnhkjdmkpanlelnlohao
0x46389a fnjhmkhhmkbjkkabndcnnogagogbneec
0x463a9d kpfopkelmapcoipemfendmdcghnegimn
0x463ca0 blnieiiffboillknjnepogjhkgnoapac
0x463ea1 hpglfhgfnhbgpjdenjgmdgoeiappafln
0x4640f9 hnfanknocfeofbddgcijnmhnfnkdnaad
0x46429d jbdaocneiiinmjbjlgalhcelgbejmnid
0x4646af ffnbelfdoeiohenkjibnmadjiehjhajb
0x4648fa fhbohimaelbohpjbbldcngcnapndodjp
0x464afd ibnejdfjmmkpcnlpebklmnkoeoihofec
0x464d00 bfnaelmomeimhlpmgjnjophhpkkoljpa
0x464e08 Oxygen
0x464edf fhilaheimglignddkjgofkcbgekhenbh
0x465036 PaliWallet
0x4650f7 mgffkfbidihjpoaomajlbgchddlicgpn
0x46531e aodkkagnadcbobfpggfnjeongemjbjca
0x465545 fmblappgoiilbgafhjklehhfifbdocee
0x46576c hmeobnfnfcmdkdcmlblgagmfpfboieaf
0x4659d8 dngmlblcodfobpdpecaadgfbcggfjfnm
0x465bff pdadjkfkgcafgbceimcpbkalnfnepbnk
0x465e26 aeachknmefphepccionboohckonoeemg
0x46604d aiifbnbfobpmeekipheeijimdpnlpgpp
0x466270 fnnegphlobjdpkhecapkijjdkgcjhkib
0x466497 lpfcbjknijpeeillifnkikgncikgfhdo
0x4666be aholpfdialjgjfhomihkjbmgjidlcdno
0x4668e5 afbcbjpbpfadlkmhmclhkeeodmamcflc
0x466a64 Keplr
0x466b0c dmkamcknogkgcdfhhbddcghachkejeap
0x466d33 fhmfendgdocmcbmfikdcogofphimnkno
0x466f5a cnmamaachppnkjgnildpdmkaakejnhae
0x467181 jojhfeoedkpkglbfimdfabpdfjaoolaf
0x4673a8 flpiciilemghbmfalicajoolhkkenfel
0x4675cf cgeeodpfagjceefieflmdfphplkenlfk
0x4677f6 acmacodkjbdgmoleebolmdjonilkdbch
0x467a1d odbfpeeihdkbihmopkbjmoonfanlbfcl
0x467c44 lpilbniiabackdjcionkobglmddfbcjo
0x467e6b bhhhlbepdkbapadjdnnojkbgioiodbic
0x468092 dkdedlpgdmmkkfjabffeganieamfklkm
0x4682b9 hcflpincpppdclinealmandijcmnkbgn
0x4684e0 mnfifefkajgofkcjkemidiaecocnkjeh
0x468707 ookjlbkiijinhpmnjffcofjonbfbgaoc
0x468929 jnkelfanjkeadonecabehalmbgpfodjm
0x468b4e jnlgamecbpmbajjfhmmmlhejkemejdma
0x468e13 kkpllkodjeloidieedojogacfhpaihoh
0x469032 mcohilncbfahbmgdjkbpemcciiolgcge
0x469243 epapihdplajcdnnkdeiahlgigofloibg
0x469454 gjagmgiddbbciopjhllkdnddhcglnemk
0x469665 kmhcihpebfmpgmihbkipmjlmmioameka
0x469883 bgpipimickeadkjlklgciifhnalhdjhe
0x469a04 Pontem Aptos Wallet
0x469af4 phkbamefinggmakgklpkljjmgibohnba
0x469d60 ejjladinnckdgjemekebdpeokbikhfci
0x469f87 gojhcdgcpbpfigcaejpfhfegekdgiblk
0x46a1f3 efbglgofoippbgcjepnhiblaibcnclgk
0x46a416 cjmkndjhnagcfbpiemnkdpomccnjblmj
0x46a682 aijcbedoijmgnlmjeegjaglmepbmpkpi
0x46a8a9 egjidjbpglichdcondbcbdnbeeppgdph
0x46ab15 oeljdldpnmdbchonielidgobddffflal
0x46ad7c ilgcnhelpchnceeipipijaljkblbcobl
0x46afe3 imloifkgjagghnnc
0x46b05b jkhggdhalmcnfklk
0x46b44e Local StateLogin Data
0x46bbe9 cookies
0x46bc81 Local StateCookies
0x46bf4f Login Data
0x46c133 \Mozilla\FirefoxFirefox\WaterfoxWaterfox
0x46c3c3 \Comodo\IceDragonIceDragon
0x46c4c9 berfox
0x46c5aa ogies\BlackHaw
0x46c679 \Moonchild Productions\Pale MoonPale Moon
0x46c785 \DiscordDiscord
0x46c81a \discordcanaryDiscordCanary\discordptbDiscordPTB
0x46c959 \discorddevelopmentDiscordDevelopment
0x46ca56 \Opera SoftwareOpera
0x46caf4 \Google\Chrome\User DataChrome
0x46cbd5 \Microsoft\Edge\User DataEdge
0x46cced \BraveSoftware\Brave-Browser\User DataBrave
0x46cde7 \CryptoTab Browser\User DataCryptoTab\Battle.netBattle.net
0x46cf71 \Chromium\User DataChromium
0x46d048 \Google(x86)\Chrome\User DataChrome (x86)
0x46d135 \Yandex\YandexBrowser\User DataYandex
0x46d21f \NVIDIA Corporation\NVIDIA GeForce ExperienceNVIDIA\SteamSteam
0x46d3ef \Amigo\User\User DataAmigo
0x46d4df \Iridium\User DataIridium
0x46d5c4 \MapleStudio\ChromePlus\User DataChromePlus
0x46d6f0 \7Star\7Star\User Data7Star
0x46d7dc \CentBrowser\User DataCentBrowser
0x46d8b5 \Chedot\User DataChedot
0x46d98b \Vivaldi\User DataVivaldi
0x46da73 \Kometa\User DataKometa
0x46db5a \Elements Browse
0x46dbc4 Elements Browser
0x46dc63 \Epic Privacy Br
0x46dcf8 Epic Privacy Bro
0x46dd87 \uCozMedia\Uran\User DatauCozMedia
0x46dea9 \Fenrir Inc\Sleipnir5\setting\modules\ChromiumViewerChromiumViewer
0x46e038 \CatalinaGroup\Citrio\User DataCitrio
0x46e0f3 \Coowon\Coowon\User DataCoowon
0x46e1dd \liebao\User Datliebao
0x46e2a4 \QIP Surf\User DtaQIP Surf
0x46e384 \Orbitum\User DaaOrbitum
0x46e47b \Comodo\Dragon\User DataDragon
0x46e544 \Torch\User Data
0x46e5af Torch
0x46e625 \Comodo\User DataComodo
0x46e71b \360Browser\Browser\User Data360Browser
0x46e7e3 \Maxthon3\User DataMaxthon3
0x46e8c2 \K-Melon\User DataK-Melon
0x46e994 \Sputnik\Sputnik\User DataSputnik
0x46ea87 \Nichrome\User DataNichrome
0x46eb78 \CocCoc\Browser\User DataCocCoc
0x46ec3a \Uran\User DataUran
0x46ecfd \Chromodo\User DataChromodo
0x46edb3 \Mail.Ru\Atom\User DataAtom
0x46ee8c \NetboxBrowser\User DataNetboxBrowser
0x46f0f1 rule_exceptionsrule_filesrule_folderrule_size_kb
0x46f262 rule_collect_recursv
0x46f301 :
0x46f386 , 
0x46f412 %DESKTOP%
0x46f548 %DOCUMENTS%
0x46f683 %USERPROFILE%
0x46f7be %APPDATA%
0x46f8f9 %LOCALAPPDATA%
0x46fa31 %RECENT%
0x46fbea (.-)*
0x46fca1 (.-)
0x46fd44 (.*)(.-)(.-)
0x470047 /
0x4707ca ld_name
0x470890 ld_geo
0x470a69  
0x470b12 ,
0x470d36 mark_check_cookies
0x470e08 mark_check_passwords
0x470eda mark_check_history
0x470fb6 mark_domains
0x471037 ,
0x471217 domain
0x47133e .
0x4715cc domain
0x4716f3 .
0x4718e4 url
0x472087 .exe
0x4720fc .
0x4721c8 exe
0x472259 msi
0x4722ea scr
0x47237b txt
0x47240c doc
0x47249d docx
0x47252e png
0x4725c2 jpg
0x472656 jpeg
0x4726ea bmp
0x47277e bat
0x472818 vbs
0x472a10 exe
0x472a99 .
0x472b1c \
0x472c1a https://
0x472d06 open
0x472ee5 \Telegram Desktop
0x473004 \tdata
0x473074 rb\key_datas
0x473165 \*.*
0x473204 rb\maps\
0x473450 \Telegram
0x4734dd \tdata
0x473572 \key_datas
0x473773 \
0x473833 \maps
0x473896 \\maps
0x473b1d s
0x473b84 \
0x473d73 logins
0x473eb6 profile
0x473f69 url
0x47400a login
0x47408b password
0x47410b logins
0x4743fc profile
0x474490 url
0x474548 login
0x474601 password
0x4746b9 logins
0x47482c profile
0x4748c1 url
0x474978 login
0x474a31 password
0x474ad7 logins
0x474bef vaultcli.dll
0x474c68 VaultEnumerateItems
0x474cfd VaultEnumerateVaultsVaultFreeVaultOpenVaultVaultCloseVaultVaultGetItemVaultGetItem
0x474f9e history
0x47504d \profiles.ini
0x4750f2 Profile
0x47519d Path
0x475208 \
0x4752ea /
0x4753c2 \
0x4754a3 \places.sqlite
0x47552b rb
0x47577a SELECT place_id, visit_date FROM
0x475904 (SELECT place_id, visit_date, id FROM moz_historyvisits ORDER BY id DESC LIMIT 2500) ORDER BY id ASC
0x475a59 )
0x475ae0 SELECT url FROM 
0x475b51 moz_places WHERE
0x475bc1  (`id` = 
0x475e9f history
0x475fb9 cookies
0x476068 \profiles.ini
0x47611f Profile
0x4761e2 Path
0x476267 \
0x476340 /
0x476426 \
0x476509 \cookies.sqlite
0x476596 rb
0x476741 SELECT host, isHttpOnly, path, isSecure, expiry, name, value FROM moz_cookies
0x476b0b httpOnly
0x476c9e secure
0x476e0e value
0x476ed0 cookies
0x476ffb download_history
0x4770ea \profiles.ini
0x4771b6 Profile
0x477276 Path
0x4772f6 \
0x4773db /
0x4774c1 \
0x47759d \places.sqlite
0x477625 rb
0x4777b8 SELECT place_id, content FROM moz_annos WHERE (`anno_attribute_id` = 1)
0x477980 )
0x4779f5 SELECT url FROM 
0x477a63 moz_places WHERE
0x477ad3  (`id` = 
0x477cbd file:///
0x477edb download_history
0x47802e autofill
0x4780f1 \profiles.ini
0x4781a4 Profile
0x478267 Path
0x4782e9 \
0x4783d1 /
0x4784ba \
0x47857c \formhistory.sqlite
0x47865f rb
0x478785 SELECT fieldname, value FROM moz_formhistory
0x478a69 autofill
0x478b7c logins
0x478c25 \profiles.ini
0x478cd4 Profile
0x478d8f Path
0x478e0f \
0x478ed7 \logins.json
0x478f5f rb
0x478ff2 \signons.sqlite
0x479146 SELECT encryptedUsername, encryptedPassword, formSubmitURL FROM moz_logins
0x4794cc login
0x479959 formSubmitURL
0x479bd6 logins
0x479e48 NSS_InitNSS_Shutdown
0x479f01 PK11_GetInternalKeySlotPK11_FreeSlot
0x479fe3 PK11_AuthenticatePK11SDR_Decrypt
0x47a281 \
0x47a433 \Local State
0x47a4d6 os_cryptos_cryptencrypted_keyos_cryptencrypted_key
0x47a7a9 \Local State\
0x47a932 os_crypt
0x47aa2c encrypted_key
0x47aaae os_crypt
0x47ab28 encrypted_key
0x47ac21 \
0x47ae67 .log
0x47af0c .ldb
0x47b24e dQw4w9WgXcQ:[^.*\['(.*)'\].*$][^"]*
0x47b3fa dQw4w9WgXcQ:
0x47b6f6 discord.com/api/v9/users/@me
0x47b815 usernameemailusername
0x47b930 email
0x47be84 \CURRENT\Sync Extension Settings\\
0x47bfed \CURRENT\Local Extension Settings\\
0x47c163 _0.indexeddb.leveldb\CURRENT\IndexedDB\chrome-extension_\
0x47c62a Settings\\Sync Extension \
0x47c789  Settings\\Local Extension\
0x47c8f5 e-extension_\IndexedDB\chromeldb\_0.indexeddb.lev
0x47cad5 \CURRENT
0x47cd9d history
0x47cef7 \
0x47d3f0 SELECT url, last_visit_time FROM(SELECT url, last_visit_time, id FROM urls ORDER
0x47d5a4  BY id DESC LIMIT 2500) ORDER BY id ASC
0x47d942 cookies
0x47dacd \Network\
0x47dd3f \
0x47de18 os_cryptos_cryptencrypted_keyos_cryptencrypted_key
0x47e0da \\
0x47e29d os_crypt
0x47e397 encrypted_key
0x47e419 os_crypt
0x47e493 encrypted_key
0x47e5d2 Network\
0x47e900 SELECT host_key, is_httponly, path, is_secure, expires_utc, name, value, encrypted_value FROM cookies
0x47ed54 httpOnly
0x47eed2 secure
0x47f0f6 v10
0x47f175 v11
0x47f23e value
0x47f529 cards
0x47f682 \
0x47f92a os_cryptos_cryptencrypted_keyos_cryptencrypted_key
0x47fbfb \
0x47fdc4 os_crypt
0x47febe encrypted_key
0x47ff40 os_crypt
0x47ffba encrypted_key
0x4803bc SELECT name_on_card, expiration_
0x480546 month, expiration_year, card_number_encrypted, origin, billing_address_id, nickname FROM credit_cards
0x4809f6 v10
0x480a72 v11
0x480c18 billing_address_
0x480f38 SELECT name_on_card, exp_month, 
0x4810be exp_year, last_four, nickname, bank_name, card_art_url, status, network FROM masked_credit_cards
0x4814ab last_four
0x4816b7 status
0x481975 download_history
0x481b13 \
0x481f6f SELECT tab_url, target_path FROM downloads
0x482359 autofill
0x4824b3 \
0x4828d1 SELECT name, value FROM autofill
0x482cba logins
0x482dfa \
0x483080 os_cryptos_cryptencrypted_keyos_cryptencrypted_key
0x483322 \\
0x4834e2 os_crypt
0x4835dc encrypted_key
0x48365e os_crypt
0x4836d8 encrypted_key
0x4839f8 SELECT action_url, origin_url, username_value, password_value FROM logins
0x483cdf v10
0x483d59 v11
0x483e0a profile
0x48414b \*
0x48422a \
0x484369 v10v11
0x484825 90
0x48489b 3
0x484ac9 freebl3.dllmozglue.dllnss3.dllsoftokn3.dllmsvcp140.dll
0x484cae vcruntime140.dll
0x484d88 \
0x48541e wb
0x48565d An uncaught exception occurred3: 
0x485869 An uncaught exception occurred3. The type was unknown so no information was available.
0x485da0 api.myip.com
0x485e6b ip
0x485f57 cc
0x4860d3 An uncaught exception occurred_ip0_1: 
0x486300 An uncaught exception occurred_ip0_1. The type was unknown so no information was available.
0x486460 api64.ipify.org/?format=json
0x486542 ip
0x4866d6 An uncaught exception occurred_ip0_2: 
0x486907 An uncaught exception occurred_ip0_2. The type was unknown so no information was available.
0x486a7d ipinfo.io/widget/demo/
0x486b5c data
0x486c2c country
0x486c96 data
0x486cfb country
0x486d7b data
0x486ddf city
0x486e47 data
0x486eab city
0x486fb6 An uncaught exception occurred_ip1: 
0x4871e3 An uncaught exception occurred_ip1. The type was unknown so no information was available.
0x487351 db-ip.com/demo/home.php?s=
0x487430 demoInfo
0x487507 countryCode
0x487574 demoInfo
0x4875dd countryCode
0x487660 demoInfo
0x4876c4 city
0x48772f demoInfo
0x487793 city
0x48789f An uncaught exception occurred_ip2: 
0x487acc An uncaught exception occurred_ip2. The type was unknown so no information was available.
0x487c81 www.maxmind.com/geoip/v2.1/city/me
0x487d6c country
0x487ead iso_code
0x487f1a country
0x487f7f iso_code
0x487fe9 city
0x48804e names
0x4880b1 en
0x48811c country
0x488181 iso_code
0x488207 city
0x48826c names
0x4882cf en
0x488405 An uncaught exception occurred_ip4: 
0x48863e An uncaught exception occurred_ip4. The type was unknown so no information was available.
0x48874a 1.1.1.1
0x4887b4 ZZ
0x488828 Unknown
0x488af8 \
0x488d05 msvcp140.dll
0x488d90 vcruntime140.dll
0x488e27 freebl3.dll
0x488e95 mozglue.dll
0x488f00 nss3.dll
0x488f6a softokn3.dll
0x489009 DLL\
0x489209 ://
0x489343 mark_name
0x4894c4 \atomic\Local Storage
0x48955b \Atomic
0x489698 \Electrum\wallets
0x489731 \Electrum
0x48985a \Exodus\exodus.wallet
0x4898f0 \Exodus
0x489a19 \Electrum-LTC\wallets
0x489ab2 \ElectrumLTC
0x489b97 \Monero\wallets
0x489c1d \Monero
0x489d43 \com.liberty.jaxx
0x489ddf \Jaxx Liberty
0x489e62 \IndexedDB
0x48a000 \Local Storage
0x48a1d3 \Session Storage
0x48a442 \Jaxx\Local Storage
0x48a4d5 \Jaxx
0x48a5f8 \Coinomi\Coinomi\wallets
0x48a68b \Coinomi
0x48a764 \Armory
0x48a90d \WalletWasabi\Client\Wallets
0x48a9a0 \Wasabi
0x48aac1 \Bither\bither.db
0x48ab56 \Bither
0x48abce \bither.db
0x48acd6 \ElectronCash\wallets
0x48ad6b \ElectronCash
0x48ae90 \Binance\app-store.json
0x48af25 \Binance
0x48afa1 \app-store.json
0x48b0a6 \Ethereum\wallets
0x48b137 \Ethereum
0x48b211 \Guarda
0x48b310 \IndexedDB
0x48b4a6 \Local Storage
0x48b673 \Session Storage
0x48b8df \MultiDoge\multidoge.wallet
0x48b97a \MultiDoge
0x48ba31 \multidoge.wallet
0x48bb0e Bitcoin
0x48bb77 DogecoinAnoncoin
0x48bc38 BBQCoinBBQCoinDashCoreFlorincoinFrankoFreicoin
0x48be71 GoldCoin (GLD)
0x48bed4 IOCoin
0x48bf39 InfinitecoinIxcoin
0x48bffd MegacoinMincoinNamecoin
0x48c123 PrimecoinTerracoinYACoinZcashdevcoindigitalcoin
0x48c35e LitecoinReddcoin
0x48c449 Daedalus Mainnet
0x48c4cb Ledger Live
0x48c629 \
0x48c6f1 \wallet.dat\
0x48c7f8 \wallet.dat\wallet.dat
0x48c90a \wallets
0x48c97a \
0x48ca1c \wallets
0x48cbb7 \Authy Desktop
0x48cc64 \Authy
0x48ccf7 \IndexedDB
0x48ce9a \Local Storage
0x48d056 \Session Storage
0x48d328 \*.*
0x48d689 \information.txt
0x48d734 wb
0x48d7c3 Version: %s


0x48d837 Date: %sUnknown
0x48d90d SOFTWARE\Microsoft\Cryptography
0x48d9cf MachineGuid
0x48da64 MachineID: %s
Unknown
0x48db55 GUID: %s
___
0x48ddcb HWID: %s

0x48de4a 
Path: %s
Work Dir: %s

IP: %s

0x48dfac Location: %s, %s

0x48e090 SOFTWARE\Microsoft\Windows NT\CurrentVersion
0x48e17b ProductNamex64x32
0x48e26b Windows: %s [%s]

0x48e36c Computer Name: %s

0x48e41f User Name: %s

0x48e4b2 Display Resolution: %dx%d

0x48e5aa Display Language: %ws
Display Language: Unknown

0x48e68a Keyboard Languages: 
0x48e78e  / %s
0x48e879 
Local Time: %d/%d/%d %d:%d:%d

0x48e9c8 TimeZone: UTC%d

0x48ea2e 
[Hardware]

0x48eac0 HARDWARE\DESCRIPTION\System\CentralProcessor\0
0x48ebf5 ProcessorNameStringProcessor: %s

0x48ecf9 CPU Count: %d

0x48ed73 RAM: %u MB

0x48eed7 VideoCard #%d: %s

0x48efd1 
[Processes]

0x48f074 %s [%d]

0x48f0dd 
[Software]

0x48f198 SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall
0x48f309 %s\%s
0x48f3cd DisplayName
0x48f462 DisplayVersion
0x48f4cf %s [%s]

0x48f5b9 wb
0x48f835 %X
0x49000f rb
0x490153 RtlGetVersionNtdll.dll
0x490244 rb
0x490d15 http:///
0x490dfa ?
0x49128d .
0x4912f3 .dll
0x49135f #
0x491491 WINHTTP.dllWinHttpConnect
0x49154f WinHttpQueryHeadersWinHttpOpen
0x49162a WinHttpOpenRequest
0x4916bd WinHttpQueryDataAvailable
0x49174c WinHttpSendRequest
0x4917df WinHttpReceiveResponseWinHttpReadData
0x4918c2 WinHttpCloseHandle
0x49194e WinHttpSetTimeouts
0x491d1e wb
0x491e39 HEAD
0x4920ed InternetOpenA
0x492159 InternetSetOptionA
0x4921e6 HttpOpenRequestA
0x492273 InternetConnectA
0x492300 InternetOpenUrlA
0x492372 HttpQueryInfoA
0x4923de InternetQueryOptionA
0x49246b HttpSendRequestA
0x4924f8 InternetReadFile
0x492585 InternetCloseHandle
done
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Hard-Limitations">
<a class="anchor" href="#Hard-Limitations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hard Limitations<a class="anchor-link" href="#Hard-Limitations"> </a>
</h3>
<p>The current approach will only work if the memory taint/trace is built in order in the code. For samples other than RisePRO compiler optimizations can lead to the "base" of the memory being located after the conents of the memory are filled - making a reverse linear search impossible. See the following example with private loader.</p>

<pre><code>.text:00991077 B8 2D 33 69 8B                          mov     eax, 8B69332Dh
.text:0099107C C7 45 B8 05 4F 11 7C                    mov     dword ptr [ebp-48h], 7C114F05h
.text:00991083 89 45 BC                                mov     [ebp-44h], eax
.text:00991086 8B 4D B8                                mov     ecx, [ebp-48h]
.text:00991089 8B 55 BC                                mov     edx, [ebp-44h]
.text:0099108C 89 4D A0                                mov     [ebp-60h], ecx  ; base offset
.text:0099108F 89 55 A4                                mov     [ebp-5Ch], edx  ; base offset + 4 (next chunk)</code></pre>
<p>The following is our failed attempt at a reverse linear search. This code may be of interest for future projects but it cannot acomplish the task above.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_xmm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">opr</span><span class="p">,</span> <span class="n">displacement</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"get_xmm_data_recursive: </span><span class="si">{</span><span class="n">opr</span><span class="si">}</span><span class="s2">, displacement=</span><span class="si">{</span><span class="n">displacement</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="c1"># Sanity check</span>
    <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">X86_OP_REG</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"ERROR Operand type is not X86_OP_MEM or X86_OP_REG"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="c1"># Track the opr memory as it moves between register and memory</span>
    <span class="n">instruction_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ptr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">instruction_count</span><span class="p">):</span>
        <span class="n">inst</span> <span class="o">=</span> <span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="p">]</span>
        <span class="c1">#logger.debug(f"recursive testing {inst} at {hex(inst.address)} ")</span>

        <span class="c1"># If the opr memory we are searching for is ESP then we need to check for stack changes</span>
        <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'sub'</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reg</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ptr</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">instruction_count</span> <span class="ow">and</span> <span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'call'</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Assuming stack change is for call at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">X86_OP_IMM</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"ERROR: Expected immediate value for stack change"</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="n">displacement</span> <span class="o">-=</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">imm</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">: sub esp New displacement: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'add'</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reg</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">X86_OP_IMM</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"ERROR: Expected immediate value for stack change"</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">displacement</span> <span class="o">+=</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">imm</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">: add esp New displacement: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'push'</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">-=</span> <span class="mi">4</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">: push New displacement: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span> <span class="o">==</span> <span class="s1">'pop'</span><span class="p">:</span>
            <span class="n">displacement</span> <span class="o">+=</span> <span class="mi">4</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">: pop New displacement: </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">displacement</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        
        <span class="c1"># Track the movs to see if they have the memory/register we are looking for</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">mnemonic</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'mov'</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span><span class="p">:</span>
                <span class="n">inst_op_mem</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span>
                <span class="k">if</span> <span class="n">inst_op_mem</span><span class="o">.</span><span class="n">disp</span> <span class="o">==</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">disp</span> <span class="o">+</span> <span class="n">displacement</span> <span class="ow">and</span> <span class="n">inst_op_mem</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span> <span class="ow">and</span> <span class="n">inst_op_mem</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">index</span> <span class="ow">and</span> <span class="n">inst_op_mem</span><span class="o">.</span><span class="n">scale</span> <span class="o">==</span> <span class="n">opr</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">scale</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_IMM</span><span class="p">:</span>
                        <span class="c1"># This might be the base with the first immedate move test of missing 3 chunks</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Test new base at with imm at  </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                        <span class="n">out_data</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;I'</span><span class="p">,</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">imm</span><span class="p">)</span>
                        <span class="n">flag_failed</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
                            <span class="n">tmp_chunk</span> <span class="o">=</span> <span class="n">get_imm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="p">:],</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">displacement</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">tmp_chunk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error no xmm found for </span><span class="si">{</span><span class="n">opr</span><span class="si">}</span><span class="s2"> at displacement </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                                <span class="n">flag_failed</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">break</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found chunk </span><span class="si">{</span><span class="n">tmp_chunk</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                            <span class="n">out_data</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;I'</span><span class="p">,</span> <span class="n">tmp_chunk</span><span class="p">)</span>   

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_failed</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">out_data</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Base incorrect continuing search..."</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found memory switch at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">inst</span><span class="si">}</span><span class="s2"> recursive search..."</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">get_xmm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="p">:],</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">opr</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span> <span class="ow">and</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_REG</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reg</span> <span class="o">==</span> <span class="n">opr</span><span class="o">.</span><span class="n">reg</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">X86_OP_MEM</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">X86_REG_ESP</span> <span class="ow">or</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span> <span class="o">==</span> <span class="n">X86_REG_EBP</span><span class="p">:</span>
                            <span class="c1"># This is as the new base if it doesn't work keep tracking with the new opr</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Test new base at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">inst</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                            <span class="n">out_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">''</span>
                            <span class="n">flag_failed</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
                                <span class="n">tmp_chunk</span> <span class="o">=</span> <span class="n">get_imm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="p">:],</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">displacement</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">tmp_chunk</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error no xmm found for </span><span class="si">{</span><span class="n">opr</span><span class="si">}</span><span class="s2"> at displacement </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                                    <span class="n">flag_failed</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="k">break</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found chunk </span><span class="si">{</span><span class="n">tmp_chunk</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
                                <span class="n">out_data</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s1">'&lt;I'</span><span class="p">,</span> <span class="n">tmp_chunk</span><span class="p">)</span>   

                            <span class="k">if</span> <span class="ow">not</span> <span class="n">flag_failed</span><span class="p">:</span>
                                <span class="k">return</span> <span class="n">out_data</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Base incorrect continuing search..."</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">new_op</span> <span class="o">=</span> <span class="n">X86Op</span><span class="p">()</span>
                            <span class="n">new_op</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">X86OpValue</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mem</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>
                            <span class="n">new_op</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">X86_OP_REG</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found memory switch with new register at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">inst</span><span class="si">}</span><span class="s2"> recursive search..."</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">get_xmm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="p">:],</span> <span class="n">new_op</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found memory switch at </span><span class="si">{</span><span class="nb">hex</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">address</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">inst</span><span class="si">}</span><span class="s2"> recursive search..."</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">get_xmm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">[</span><span class="n">ptr</span><span class="p">:],</span> <span class="n">inst</span><span class="o">.</span><span class="n">operands</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">get_string_from_pxor_xmm</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">xmm1</span><span class="p">):</span>
    <span class="n">data0</span> <span class="o">=</span> <span class="n">get_xmm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">xmm0</span><span class="p">,</span> <span class="n">displacement</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error no data found for xmm0 </span><span class="si">{</span><span class="n">xmm0</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found data for xmm0 </span><span class="si">{</span><span class="n">data0</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">data1</span> <span class="o">=</span> <span class="n">get_xmm_data_recursive</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">xmm1</span><span class="p">,</span> <span class="n">displacement</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
    <span class="k">if</span> <span class="n">data1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>   
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error no data found for xmm1 </span><span class="si">{</span><span class="n">xmm1</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span> 
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found data for xmm1 </span><span class="si">{</span><span class="n">data0</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">data0</span><span class="p">,</span> <span class="n">data1</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">,</span><span class="sa">b</span><span class="s1">''</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_ascii</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">'utf-8'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Memory-Only-Emulation-Trace-(@mishap)">
<a class="anchor" href="#Memory-Only-Emulation-Trace-(@mishap)" aria-hidden="true"><span class="octicon octicon-link"></span></a>Memory-Only Emulation Trace (@mishap)<a class="anchor-link" href="#Memory-Only-Emulation-Trace-(@mishap)"> </a>
</h2>
<p>A more comprehensive approach may be to use this novel memory-only emulation approach by <a href="https://github.com/oopsmishap">@mishap</a> <a href="https://gist.github.com/oopsmishap/d8f72e3f2324691f0067ed473278dff3">pxor_string_decrypt_wip.py</a>.</p>
<p><strong>TODO</strong> combine this emulation approach with our scanner.</p>

</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/xorstr/decryption/python/2023/06/25/xorstr.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>

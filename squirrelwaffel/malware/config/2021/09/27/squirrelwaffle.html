<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>SquirrelWaffel Config Extraction | OALABS Research</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="SquirrelWaffel Config Extraction" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Writing a config extractor for SquirrelWaffel" />
<meta property="og:description" content="Writing a config extractor for SquirrelWaffel" />
<link rel="canonical" href="https://research.openanalysis.net/squirrelwaffel/malware/config/2021/09/27/squirrelwaffle.html" />
<meta property="og:url" content="https://research.openanalysis.net/squirrelwaffel/malware/config/2021/09/27/squirrelwaffle.html" />
<meta property="og:site_name" content="OALABS Research" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-27T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SquirrelWaffel Config Extraction" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-27T00:00:00-05:00","datePublished":"2021-09-27T00:00:00-05:00","description":"Writing a config extractor for SquirrelWaffel","headline":"SquirrelWaffel Config Extraction","mainEntityOfPage":{"@type":"WebPage","@id":"https://research.openanalysis.net/squirrelwaffel/malware/config/2021/09/27/squirrelwaffle.html"},"url":"https://research.openanalysis.net/squirrelwaffel/malware/config/2021/09/27/squirrelwaffle.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://research.openanalysis.net/feed.xml" title="OALABS Research" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">OALABS Research</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">SquirrelWaffel Config Extraction</h1><p class="page-description">Writing a config extractor for SquirrelWaffel</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-09-27T00:00:00-05:00" itemprop="datePublished">
        Sep 27, 2021
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#squirrelwaffel">squirrelwaffel</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#malware">malware</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#config">config</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-left">
            <div class="px-2">
                <a href="https://www.youtube.com/c/OALabs" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/badge/-YouTube-FF0000" alt="Join us on YouTube">
                </a>
            </div>
            <div class="px-2">
                <a href="https://www.twitch.tv/oalabslive" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/twitch/status/oalabslive?style=social" alt="Join us on Twitch">
                </a>
            </div>
            <div class="px-2">
                <a href="https://discord.gg/cw4U3WHvpn" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/badge/-Join Our Discord-blueviolet" alt="Join Discord">
                </a>
            </div>
            <div class="px-2">
                <a href="https://www.patreon.com/oalabs" role="button" target="_blank">
                    <img class="notebook-badge-image" src="https://img.shields.io/badge/-OALABS Patreon-FF424D" alt="Support us on Patreon">
                </a>
            </div>
          <div class="px-2">

    <a href="https://github.com/OALabs/research/tree/master/_notebooks/2021-09-27-squirrelwaffle.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          
          
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Overview">Overview </a></li>
<li class="toc-entry toc-h2"><a href="#References">References </a></li>
<li class="toc-entry toc-h2"><a href="#Setup">Setup </a></li>
<li class="toc-entry toc-h2"><a href="#Extract-the-.rdata-section">Extract the .rdata section </a></li>
<li class="toc-entry toc-h2"><a href="#Parse-.rdata">Parse .rdata </a></li>
<li class="toc-entry toc-h2"><a href="#Decryption-function">Decryption function </a></li>
<li class="toc-entry toc-h2"><a href="#Decrypt-the-blocklist">Decrypt the blocklist </a></li>
<li class="toc-entry toc-h2"><a href="#Decrypt-the-c2s">Decrypt the c2s </a></li>
<li class="toc-entry toc-h2"><a href="#Clean-up-the-c2-list">Clean up the c2 list </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-09-27-squirrelwaffle.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Overview">
<a class="anchor" href="#Overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview<a class="anchor-link" href="#Overview"> </a>
</h2>
<p>Notes from our live stream where we reverse engineered the squirrelwaffle loader and built a static config extractor for it.

</p>
<center class="youtube-iframe-wrapper">
    <iframe width="730" height="315" src="https://www.youtube.com/embed/9X2P7aFKSw0" frameborder="0" allowfullscreen=""></iframe>
</center>

<h2 id="References">
<a class="anchor" href="#References" aria-hidden="true"><span class="octicon octicon-link"></span></a>References<a class="anchor-link" href="#References"> </a>
</h2>
<ul>
<li><a href="https://www.malware-traffic-analysis.net/2021/09/17/index.html">Malware Traffic Analysis Sample 1</a></li>
<li><a href="https://www.malware-traffic-analysis.net/2021/09/21/index2.html">Malware Traffic Analysis Sample 2</a></li>
<li><a href="https://malshare.com/sample.php?action=detail&amp;hash=6095f96dd5eca96a3fb9338eec4ab574921c0febb36f6a6db60aae1aeb9ffcab">Unpacked Sample (malshare)</a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup">
<a class="anchor" href="#Setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup<a class="anchor-link" href="#Setup"> </a>
</h2>
<p>Make sure you have pefile installed <code>pip install pefile</code> and you change the <code>SAMPLE_PATH</code> to the squirrelwaffle sample you have downloaded.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pefile</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SAMPLE_PATH</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'/tmp/squirrel.bin'</span>
<span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">SAMPLE_PATH</span><span class="p">,</span><span class="s1">'rb'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Extract-the-.rdata-section">
<a class="anchor" href="#Extract-the-.rdata-section" aria-hidden="true"><span class="octicon octicon-link"></span></a>Extract the .rdata section<a class="anchor-link" href="#Extract-the-.rdata-section"> </a>
</h2>
<p>The <code>.rdata</code> section has the encrypted data and the decryption keys so let's grab that first.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pe</span> <span class="o">=</span> <span class="n">pefile</span><span class="o">.</span><span class="n">PE</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">rdata</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">pe</span><span class="o">.</span><span class="n">sections</span><span class="p">:</span>
    <span class="k">if</span> <span class="sa">b</span><span class="s1">'.rdata'</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">Name</span><span class="p">:</span>
        <span class="n">rdata</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="nb">len</span><span class="p">(</span><span class="n">rdata</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>20480</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Parse-.rdata">
<a class="anchor" href="#Parse-.rdata" aria-hidden="true"><span class="octicon octicon-link"></span></a>Parse .rdata<a class="anchor-link" href="#Parse-.rdata"> </a>
</h2>
<p>The encrypted strings in the <code>.rdata</code> section are followed by their key and all data, keys, and strings are seperated by null bytes. We can parse out the data and key by splitting the <code>.rdata</code> on null bytes then looking for the largest blocks of data. These are likely the encrypted blocklist and the encrypted c2 list.</p>
<p>We want to maintain two lists of data blocks, one sorted and one original order. This way we can use the sorted list to get the largest blocks, and the original order list to find the key which is sequentially after the encrypted data.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">blocks</span> <span class="o">=</span> <span class="n">rdata</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">'</span><span class="se">\x00</span><span class="s1">'</span><span class="p">)</span>
<span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="sa">b</span><span class="s1">''</span><span class="p">]</span>
<span class="n">blocks_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Decryption-function">
<a class="anchor" href="#Decryption-function" aria-hidden="true"><span class="octicon octicon-link"></span></a>Decryption function<a class="anchor-link" href="#Decryption-function"> </a>
</h2>
<p>The config decryption is a simple xor so we want to replicate this in python</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">out</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Decrypt-the-blocklist">
<a class="anchor" href="#Decrypt-the-blocklist" aria-hidden="true"><span class="octicon octicon-link"></span></a>Decrypt the blocklist<a class="anchor-link" href="#Decrypt-the-blocklist"> </a>
</h2>
<p>The largest encrupted block is likely the blocklist so let's decrypt that first.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">blocks_sorted</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>94.46.179.80
206.189.205.251
88.242.66.45
85.75.110.214
87.104.3.136
207.244.91.171
49.230.88.160
91.149.252.75
91.149.252.88
92.211.109.152
178.0.250.168
88.69.16.230
95.223.77.160
99.234.62.23
2.206.105.223
84.222.8.201
89.183.239.142
5.146.132.101
77.7.60.154
45.41.106.122
45.74.72.13
74.58.152.123
88.87.68.197
109.70.100.25
185.67.82.114
207.102.138.19
204.101.161.14
193.128.108.251
111.7.100.17
111.7.100.16
74.125.210.62
74.125.210.36
104.244.74.57
185.220.101.145
185.220.101.144
185.220.101.18
185.220.100.246
185.220.101.228
185.220.100.243
185.220.101.229
185.220.101.147
185.220.102.250
185.220.100.241
199.195.251.84
213.164.204.94
74.125.213.7
74.125.213.9
185.220.100.249
37.71.173.58
93.2.220.100
188.10.191.109
81.36.17.247
70.28.47.118
45.133.172.222
108.41.227.196
37.235.53.46
162.216.47.22
154.3.42.51
45.86.200.60
212.230.181.152
185.192.70.11
37.142.65.69
87.166.51.31
178.198.76.175
128.90.172.136
172.58.227.224
201.77.112.133
64.124.12.162
87.166.51.28
104.244.72.115
109.70.100.23
192.145.127.220
194.186.142.122
185.207.249.217
52.250.42.144
45.86.201.156
195.245.199.125
213.33.190.70
154.61.71.13
154.13.1.22
191.96.185.151
40.94.25.22
40.94.25.39
40.94.25.5
40.94.25.79
40.94.25.69
40.94.25.71
40.94.25.60
40.94.25.64
40.94.25.29
40.94.25.23
40.94.25.89
40.94.26.165
40.94.26.210
40.94.26.208
40.94.26.166
40.94.26.216
40.94.26.173
40.94.26.182
40.94.35.75
40.94.35.97
40.94.35.27
40.94.35.38
40.94.35.46
40.94.35.76
40.94.35.70
40.94.35.80
40.94.35.98
40.94.35.40
45.86.200.23
198.167.212.98
40.94.31.87
40.94.31.85
40.94.31.29
40.94.31.97
40.94.31.88
40.94.31.80
40.94.31.65
198.167.195.112
40.94.31.58
40.94.31.48
40.94.31.64
40.94.31.26
40.94.31.66
40.94.31.90
40.94.31.46
40.94.31.47
212.119.227.184
72.12.194.93
72.12.194.94
72.12.194.92
134.209.213.55
35.198.84.59
89.208.29.2
40.94.30.159
40.94.30.139
40.94.30.152
40.94.30.167
40.94.30.164
40.94.30.166
40.94.30.174
40.94.30.151
154.61.71.53
40.94.30.157
40.94.30.136
40.94.30.149
52.154.162.74
213.33.190.161
83.84.25.214
162.251.62.154
188.241.177.152
92.211.110.221
154.61.71.51
185.183.107.236
72.12.194.90
40.94.25.36
40.94.29.4
40.94.25.50
40.94.29.31
40.94.25.31
40.94.29.41
40.94.31.5
40.94.25.80
40.94.29.82
40.94.31.81
40.94.25.96
40.94.29.59
40.94.31.3
40.94.25.58
40.94.31.61
40.94.31.49
40.94.31.54
40.94.31.62
40.94.31.70
40.94.30.211
40.94.30.148
40.94.30.218
40.94.30.147
40.94.30.129
40.94.31.15
40.94.30.169
40.94.31.36
40.94.30.223
40.94.30.203
95.211.36.179
64.233.172.102
153.246.206.71
198.167.193.35
90.187.12.209
37.49.116.179
52.167.22.240
160.177.96.15
185.123.143.220
167.99.172.253
40.94.36.81
86.107.21.203
24.37.31.38
71.19.154.84
34.142.74.220
192.160.102.170
216.251.130.74
49.44.76.43
109.147.65.157
86.217.130.91
178.174.15.54
86.242.244.97
92.46.70.105
81.201.234.26
78.94.217.60
141.226.236.91
95.26.228.102
89.208.29.3
213.33.190.205
213.33.190.121
5.154.174.45
23.154.177.3
195.65.152.138
93.231.174.227
185.220.101.132
54.36.101.21
72.12.194.91
46.14.116.174
141.19.232.57
185.220.101.149
45.74.46.69
157.230.210.133
82.199.130.36
104.237.193.28
187.46.138.56
195.164.49.162
156.146.49.135
195.164.49.191
79.104.209.54
35.245.134.90
20.52.139.186
189.139.144.151
94.31.102.187
39.43.45.71
107.189.10.143
39.43.123.57
106.75.76.179
194.186.142.131
210.22.129.194
45.130.83.77
154.6.16.175
162.247.73.192
107.189.1.160
185.107.47.215
46.166.139.111
185.56.80.65
185.220.100.245
209.141.59.180
77.247.181.163
185.220.101.137
185.220.100.242
104.244.76.13
185.83.214.69
185.220.100.252
185.112.146.73
185.57.82.28
89.187.171.116
66.220.242.222
39.43.72.17
5.171.90.80
185.152.32.77
23.129.64.157
92.151.9.187
106.75.31.237
122.167.79.251
109.70.100.33
199.249.230.154
64.233.172.108
64.233.172.106
64.233.172.104
77.247.181.165
107.189.12.240
79.142.76.203
193.128.114.34
185.92.26.59
185.65.210.119
70.39.159.79
70.39.159.29
151.48.26.15
151.48.26.15
2.228.159.178
188.174.248.154
188.174.248.154
95.90.198.182
95.90.198.182
193.0.200.36
193.0.200.36
151.127.13.232
89.97.249.158
212.115.152.225
185.217.117.179
199.249.230.164
80.233.134.134
109.74.154.92
65.39.88.250
90.84.192.187
37.70.202.24
85.203.45.30
109.190.93.219
151.8.114.194
176.235.38.106
149.56.99.85
138.128.136.169
213.82.23.224
192.42.123.107
128.90.151.188
162.245.206.249
85.203.45.40
95.211.95.242
185.220.102.251
66.203.112.160
193.128.108.246
193.128.108.242
31.204.150.74
34.141.245.25
122.167.85.191
212.6.86.133
171.25.193.25
149.3.170.147
162.247.74.217
109.70.100.34
89.208.29.5
79.104.209.91
79.104.209.157
194.186.142.205
198.167.217.20
198.167.193.112
204.101.161.31
198.167.219.82
195.74.76.222
70.93.153.224
87.118.110.27
185.247.225.43
193.128.108.250
188.212.135.7
106.75.75.245
86.142.177.106
185.192.69.77
198.167.209.37
59.144.163.235
193.128.108.243
31.204.152.150
211.177.21.222
87.166.49.39
82.127.202.176
58.40.175.6

94.46.179.80
206.189.205.251
178.255.172.194
84.221.205.40
155.138.242.103
178.212.98.156
85.65.32.191
31.167.184.201
88.242.66.45
36.65.102.42
203.213.127.79
85.75.110.214
93.78.214.187
204.152.81.185
183.171.72.218
168.194.101.130
87.104.3.136
92.211.196.33
197.92.140.125
207.244.91.171
49.230.88.160
196.74.16.153
91.149.252.75
91.149.252.88
92.206.15.202
82.21.114.63
92.211.109.152
178.0.250.168
178.203.145.135
85.210.36.4
199.83.207.72
86.132.134.203
88.69.16.230
99.247.129.88
37.201.195.12
87.140.192.0
88.152.185.188
87.156.177.91
99.229.57.160
95.223.77.160
88.130.54.214
99.234.62.23
2.206.105.223
94.134.179.130
84.221.255.199
84.222.8.201
89.183.239.142
87.158.21.26
93.206.148.216
5.146.132.101
77.7.60.154
95.223.75.85
162.254.173.187
50.99.254.163
45.41.106.122
99.237.13.3
45.74.72.13
108.171.64.202
74.58.152.123
216.209.253.121
88.87.68.197
211.107.25.121
109.70.100.25
185.67.82.114
207.102.138.19
204.101.161.14
193.128.108.251
111.7.100.17
111.7.100.16
74.125.210.62
74.125.210.36

104.244.74.57
185.220.101.145
185.220.101.144
185.220.101.18
185.220.100.246
185.220.101.228
185.220.100.243
185.220.101.229
185.220.101.147
185.220.102.250
185.220.100.241
199.195.251.84
213.164.204.94
74.125.213.7
74.125.213.9
177.38.183.13
185.220.100.249
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Decrypt-the-c2s">
<a class="anchor" href="#Decrypt-the-c2s" aria-hidden="true"><span class="octicon octicon-link"></span></a>Decrypt the c2s<a class="anchor-link" href="#Decrypt-the-c2s"> </a>
</h2>
<p>The second largest encrupted block is likely the C2 list so let's decrypt that now.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">blocks_sorted</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">blocks</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>celulasmadreenmexico.com.mx/Wt793Aua|gerencial.institutoacqua.org.br/XynFkhJAxnm|dashboard.adlytic.ai/LlvLoc9O3|bussiness-z.ml/3pdEiqsni|ifiengineers.com/hGVc55g2e|bonusvulkanvegas.srdm.in/U7oOxmI1m|ebrouteindia.com/JEqGe1hNR|test.dirigu.ro/dXf4cS4GPL|cablingpoint.com/LjDG0hkp|perfectdemos.com/T6PQGYCMt|afrizam.360cyberlink.com/f36rjSN5D1|giasuphire.tddvn.com/miFO43YP9b|priyacareers.com/GiTHMPbU|assurant.360cyberlink.com/DGx4k8U9Hil|sig.institutoacqua.org.br/tM7tINg2sCU|
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Clean-up-the-c2-list">
<a class="anchor" href="#Clean-up-the-c2-list" aria-hidden="true"><span class="octicon octicon-link"></span></a>Clean up the c2 list<a class="anchor-link" href="#Clean-up-the-c2-list"> </a>
</h2>
<p>It looks like the C2 list is seperated by pipes <code>|</code> so let's turn that into a nice list.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'|'</span><span class="p">,</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>celulasmadreenmexico.com.mx/Wt793Aua
gerencial.institutoacqua.org.br/XynFkhJAxnm
dashboard.adlytic.ai/LlvLoc9O3
bussiness-z.ml/3pdEiqsni
ifiengineers.com/hGVc55g2e
bonusvulkanvegas.srdm.in/U7oOxmI1m
ebrouteindia.com/JEqGe1hNR
test.dirigu.ro/dXf4cS4GPL
cablingpoint.com/LjDG0hkp
perfectdemos.com/T6PQGYCMt
afrizam.360cyberlink.com/f36rjSN5D1
giasuphire.tddvn.com/miFO43YP9b
priyacareers.com/GiTHMPbU
assurant.360cyberlink.com/DGx4k8U9Hil
sig.institutoacqua.org.br/tM7tINg2sCU

</pre>
</div>
</div>

</div>
</div>

</div>
    

</div>



  </div><a class="u-url" href="/squirrelwaffel/malware/config/2021/09/27/squirrelwaffle.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p></p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"></ul>
</div>

  </div>

</footer>
</body>

</html>
